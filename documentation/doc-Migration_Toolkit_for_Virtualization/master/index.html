<!DOCTYPE html>
<html lang="en-US">
  <head>

    
    <meta charset="UTF-8">
    
    <title>Installing and using Forklift 2.3 | Forklift Documentation</title>
    <!-- # Opengraph protocol properties: https://ogp.me/ -->
    <meta name="author" content="Forklift documentation team" >
    <meta property="og:type" content="article" >
    <meta name="twitter:card" content="summary">
    <meta name="keywords" content="" >
    <meta property="og:type" content="website">
    <meta property="og:image" content="">
    <meta property="og:article:author" content="Forklift documentation team" >
    <meta property="og:article:published_time" content="2024-05-12 19:37:17 -0500" >
    <meta name="twitter:title" content="Installing and using Forklift 2.3 | Forklift Documentation">
    <meta name="twitter:description" content="Migrating VMware virtual machines to KubeVirt">

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Installing and using Forklift 2.3 | Forklift Documentation</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Installing and using Forklift 2.3" />
<meta name="author" content="Forklift documentation team" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Migrating VMware virtual machines to KubeVirt" />
<meta property="og:description" content="Migrating VMware virtual machines to KubeVirt" />
<meta property="og:site_name" content="Forklift Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Installing and using Forklift 2.3" />
<meta name="twitter:site" content="@konveyor_io" />
<meta name="twitter:creator" content="@Forklift documentation team" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Forklift documentation team"},"description":"Migrating VMware virtual machines to KubeVirt","headline":"Installing and using Forklift 2.3","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/img/forklift-logo-darkbg.svg"},"name":"Forklift documentation team"},"url":"/documentation/doc-Migration_Toolkit_for_Virtualization/master/"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png">
  </head>
  <body>
    <header class="page-header">
        
          <a href="/"><img src="/assets/img/forklift-logo-darkbg.svg" alt="Forklift Documentation" width="200" /></a><br>
        
      
        <a href="https://github.com/konveyor/forklift-documentation" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h1>Installing and using Forklift 2.3</h1>
<div id="toc" class="toc">
<div id="toctitle"></div>
<ul class="sectlevel1">
<li><a href="#about-mtv_forklift">About  Forklift</a>
<ul class="sectlevel2">
<li><a href="#about-cold-warm-migration_forklift">About cold and warm migration</a>
<ul class="sectlevel3">
<li><a href="#cold-migration_forklift">Cold migration</a></li>
<li><a href="#warm-migration_forklift">Warm migration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#prerequisites_forklift">Prerequisites</a>
<ul class="sectlevel2">
<li><a href="#software-requirements_forklift">Software requirements</a></li>
<li><a href="#about-storage_forklift">Storage support and default modes</a></li>
<li><a href="#network-prerequisites_forklift">Network prerequisites</a>
<ul class="sectlevel3">
<li><a href="#ports_forklift">Ports</a></li>
</ul>
</li>
<li><a href="#source-vm-prerequisites_forklift">Source virtual machine prerequisites</a></li>
<li><a href="#rhv-prerequisites_forklift">oVirt prerequisites</a></li>
<li><a href="#openstack-prerequisites_forklift">OpenStack prerequisites</a>
<ul class="sectlevel3">
<li><a href="#additional-authentication-for-osp_forklift">Additional authentication methods for migrations with OpenStack source providers</a></li>
</ul>
</li>
<li><a href="#vmware-prerequisites_forklift">VMware prerequisites</a>
<ul class="sectlevel3">
<li><a href="#creating-vddk-image_forklift">Creating a VDDK image</a></li>
<li><a href="#increasing-nfc-memory-vmware-host_forklift">Increasing the NFC service memory of an ESXi host</a></li>
</ul>
</li>
<li><a href="#ova-prerequisites_forklift">Open Virtual Appliance (OVA) prerequisites</a></li>
<li><a href="#compatibility-guidelines_forklift">Software compatibility guidelines</a>
<ul class="sectlevel3">
<li><a href="#openshift-operator-life-cycles">OpenShift Operator Life Cycles</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#installing-the-operator_forklift">Installing and configuring the Forklift Operator</a>
<ul class="sectlevel2">
<li><a href="#installing-mtv-operator_forklift">Installing the Forklift Operator by using the OKD web console</a></li>
<li><a href="#installing-mtv-operator_forklift">Installing the Forklift Operator from the command line interface</a></li>
<li><a href="#configuring-mtv-operator_forklift">Configuring the Forklift Operator</a></li>
</ul>
</li>
<li><a href="#migrating-vms-web-console_forklift">Migrating virtual machines by using the OKD web console</a>
<ul class="sectlevel2">
<li><a href="#mtv-ui_forklift">The MTV user interface</a></li>
<li><a href="#mtv-overview-page_forklift">The MTV Overview page</a>
<ul class="sectlevel3">
<li><a href="#overview-tab_forklift">Overview tab</a></li>
<li><a href="#yaml-tab_forklift">YAML tab</a></li>
<li><a href="#metrics-tab_forklift">Metrics tab</a></li>
</ul>
</li>
<li><a href="#mtv-settings_forklift">Configuring MTV settings</a></li>
<li><a href="#adding-providers">Adding providers</a>
<ul class="sectlevel3">
<li><a href="#adding-source-providers">Adding source providers</a></li>
<li><a href="#adding-destination-providers">Adding destination providers</a></li>
</ul>
</li>
<li><a href="#creating-migration-plans-ui">Creating migration plans</a>
<ul class="sectlevel3">
<li><a href="#creating-migration-quick-plan-vm_forklift">Creating and running a migration plan starting on Providers for virtualization</a></li>
<li><a href="#creating-migration-quick-plan-existing-source_forklift">Creating and running a migration plan starting on Plans for virtualization</a></li>
</ul>
</li>
<li><a href="#running-migration-plan_forklift">Running a migration plan</a></li>
<li><a href="#migration-plan-options-ui_forklift">Migration plan options</a></li>
<li><a href="#canceling-migration-ui_forklift">Canceling a migration</a></li>
</ul>
</li>
<li><a href="#migrating-virtual-machines-from-the-command-line_forklift">Migrating virtual machines from the command line</a>
<ul class="sectlevel2">
<li><a href="#non-admin-permissions_forklift">Permissions needed by non-administrators to work with migration plan components</a></li>
<li><a href="#migrating-virtual-machines_forklift">Migrating virtual machines</a>
<ul class="sectlevel3">
<li><a href="#new-migrating-virtual-machines-cli_forklift">Migrating from a VMware vSphere source provider</a></li>
<li><a href="#new-migrating-virtual-machines-cli_forklift">Migrating from a oVirt source provider</a></li>
<li><a href="#new-migrating-virtual-machines-cli_forklift">Migrating from an OpenStack source provider</a></li>
<li><a href="#new-migrating-virtual-machines-cli_forklift">Migrating from an Open Virtual Appliance (OVA) source provider</a></li>
<li><a href="#new-migrating-virtual-machines-cli_forklift">Migrating from a Red Hat KubeVirt source provider</a></li>
</ul>
</li>
<li><a href="#canceling-migration-cli_forklift">Canceling a migration</a></li>
</ul>
</li>
<li><a href="#advanced-migration-options_forklift">Advanced migration options</a>
<ul class="sectlevel2">
<li><a href="#changing-precopy-intervals_forklift">Changing precopy intervals for warm migration</a></li>
<li><a href="#creating-custom-rules-for-validation-service">Creating custom rules for the Validation service</a>
<ul class="sectlevel3">
<li><a href="#about-rego-files_forklift">About Rego files</a></li>
<li><a href="#accessing-default-validation-rules_forklift">Checking the default validation rules</a></li>
<li><a href="#retrieving-validation-service-json_forklift">Retrieving the Inventory service JSON</a></li>
<li><a href="#creating-validation-rule_forklift">Creating a validation rule</a></li>
<li><a href="#updating-inventory-rules-version_forklift">Updating the inventory rules version</a></li>
</ul>
</li>
<li><a href="#adding-hooks-migration-plan-using-api">Adding hooks to a migration plan</a>
<ul class="sectlevel3">
<li><a href="#about-api-hooks-in-migration-plans_forklift">API-based hooks for Forklift migration plans</a></li>
<li><a href="#adding-hook-crs-migration-plans-api_forklift">Adding Hook CRs to a VM migration by using the Forklift API</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#upgrading-mtv-ui_forklift">Upgrading  Forklift</a></li>
<li><a href="#uninstalling-mtv_forklift">Uninstalling  Forklift</a>
<ul class="sectlevel2">
<li><a href="#uninstalling-mtv-ui_forklift">Uninstalling Forklift by using the OKD web console</a></li>
<li><a href="#uninstalling-mtv-cli_forklift">Uninstalling Forklift from the command line interface</a></li>
</ul>
</li>
<li><a href="#troubleshooting_forklift">Troubleshooting</a>
<ul class="sectlevel2">
<li><a href="#error-messages_forklift">Error messages</a></li>
<li><a href="#using-must-gather_forklift">Using the must-gather tool</a></li>
<li><a href="#architecture_forklift">Architecture</a>
<ul class="sectlevel3">
<li><a href="#mtv-resources-and-services_forklift">Forklift custom resources and services</a></li>
<li><a href="#mtv-workflow_forklift">High-level migration workflow</a></li>
<li><a href="#virt-migration-workflow_forklift">Detailed migration workflow</a></li>
</ul>
</li>
<li><a href="#logs-and-crs_forklift">Logs and custom resources</a>
<ul class="sectlevel3">
<li><a href="#collected-logs-cr-info_forklift">Collected logs and custom resource information</a></li>
<li><a href="#accessing-logs-ui_forklift">Downloading logs and custom resource information from the web console</a></li>
<li><a href="#accessing-logs-cli_forklift">Accessing logs and custom resource information from the command line interface</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="sect1">
<h2 id="about-mtv_forklift">About  Forklift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can use  Forklift to migrate virtual machines from the following source providers to KubeVirt destination providers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VMware vSphere</p>
</li>
<li>
<p>oVirt (oVirt)</p>
</li>
<li>
<p>OpenStack</p>
</li>
<li>
<p>Open Virtual Appliances (OVAs) that were created by VMware vSphere</p>
</li>
<li>
<p>Remote KubeVirt clusters</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://access.redhat.com/articles/6242511">Performance recommendations for migrating from VMware vSphere to OpenShift Virtualization</a>.</p>
</li>
<li>
<p><a href="https://access.redhat.com/articles/6380311">Performance recommendations for migrating from Red Hat Virtualization to OpenShift Virtualization</a>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="about-cold-warm-migration_forklift">About cold and warm migration</h3>
<div class="paragraph">
<p>Forklift supports cold migration from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VMware vSphere</p>
</li>
<li>
<p>oVirt (oVirt)</p>
</li>
<li>
<p>OpenStack</p>
</li>
<li>
<p>Remote KubeVirt clusters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Forklift supports warm migration from VMware vSphere and from oVirt.</p>
</div>
<div class="sect3">
<h4 id="cold-migration_forklift">Cold migration</h4>
<div class="paragraph">
<p>Cold migration is the default migration type. The source virtual machines are shut down while the data is copied.</p>
</div>
</div>
<div class="sect3">
<h4 id="warm-migration_forklift">Warm migration</h4>
<div class="paragraph">
<p>Most of the data is copied during the <em>precopy</em> stage while the source virtual machines (VMs) are running.</p>
</div>
<div class="paragraph">
<p>Then the VMs are shut down and the remaining data is copied during the <em>cutover</em> stage.</p>
</div>
<div class="paragraph">
<div class="title">Precopy stage</div>
<p>The VMs are not shut down during the precopy stage.</p>
</div>
<div class="paragraph">
<p>The VM disks are copied incrementally using <a href="https://kb.vmware.com/s/article/1020128">changed block tracking (CBT)</a> snapshots. The snapshots are created at one-hour intervals by default. You can change the snapshot interval by updating the <code>forklift-controller</code> deployment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must enable CBT for each source VM and each VM disk.</p>
</div>
<div class="paragraph">
<p>A VM can support up to 28 CBT snapshots. If the source VM has too many CBT snapshots and the <code>Migration Controller</code> service is not able to create a new snapshot, warm migration might fail. The <code>Migration Controller</code> service deletes each snapshot when the snapshot is no longer required.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The precopy stage runs until the cutover stage is started manually or is scheduled to start.</p>
</div>
<div class="paragraph">
<div class="title">Cutover stage</div>
<p>The VMs are shut down during the cutover stage and the remaining data is migrated. Data stored in RAM is not migrated.</p>
</div>
<div class="paragraph">
<p>You can start the cutover stage manually by using the Forklift console or you can schedule a cutover time in the <code>Migration</code> manifest.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites_forklift">Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Review the following prerequisites to ensure that your environment is prepared for migration.</p>
</div>
<div class="sect2">
<h3 id="software-requirements_forklift">Software requirements</h3>
<div class="paragraph">
<p>You must install <a href="#compatibility-guidelines_forklift">compatible versions</a> of OKD and KubeVirt.</p>
</div>
</div>
<div class="sect2">
<h3 id="about-storage_forklift">Storage support and default modes</h3>
<div class="paragraph">
<p>Forklift uses the following default volume and access modes for supported storage.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Default volume and access modes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Provisioner</th>
<th class="tableblock halign-left valign-top">Volume mode</th>
<th class="tableblock halign-left valign-top">Access mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.io/aws-ebs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteOnce</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.io/azure-disk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteOnce</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.io/azure-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filesystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteMany</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.io/cinder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteOnce</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.io/gce-pd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteOnce</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.io/hostpath-provisioner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filesystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteOnce</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">manila.csi.openstack.org</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filesystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteMany</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openshift-storage.cephfs.csi.ceph.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filesystem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteMany</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">openshift-storage.rbd.csi.ceph.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteOnce</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.io/rbd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteOnce</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kubernetes.io/vsphere-volume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ReadWriteOnce</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the KubeVirt storage does not support <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.10/html/storage/dynamic-provisioning">dynamic provisioning</a>, you must apply the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Filesystem</code> volume mode</p>
<div class="paragraph">
<p><code>Filesystem</code> volume mode is slower than <code>Block</code> volume mode.</p>
</div>
</li>
<li>
<p><code>ReadWriteOnce</code> access mode</p>
<div class="paragraph">
<p><code>ReadWriteOnce</code> access mode does not support live virtual machine migration.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.10/html/virtualization/virtual-machines#virt-customizing-storage-profile_virt-creating-data-volumes">Enabling a statically-provisioned storage class</a> for details on editing the storage profile.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your migration uses block storage and persistent volumes created with an EXT4 file system, increase the file system overhead in CDI to be more than 10%. The default overhead that is assumed by CDI does not completely include the reserved place for the root partition. If you do not increase the file system overhead in CDI by this amount, your migration might fail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When migrating from OpenStack or running a cold-migration from RHV to the OCP cluster that MTV is deployed on, the migration allocates persistent volumes without CDI. In these cases, you might need to adjust the file system overhead.</p>
</div>
<div class="paragraph">
<p>If the configured file system overhead, which has a default value of 10%, is too low, the disk transfer will fail due to lack of space. In such a case, you would want to increase the file system overhead.</p>
</div>
<div class="paragraph">
<p>In some cases, however, you might want to decrease the file system overhead to reduce storage consumption.</p>
</div>
<div class="paragraph">
<p>You can change the file system overhead by changing the value of the <code>controller_filesystem_overhead</code> in the <code>spec</code> portion of the <code>forklift-controller</code> CR, as described in <a href="#configuring-mtv-operator_forklift">Configuring the MTV Operator</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="network-prerequisites_forklift">Network prerequisites</h3>
<div class="paragraph">
<p>The following prerequisites apply to all migrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IP addresses, VLANs, and other network configuration settings must not be changed before or during migration. The MAC addresses of the virtual machines are preserved during migration.</p>
</li>
<li>
<p>The network connections between the source environment, the KubeVirt cluster, and the replication repository must be reliable and uninterrupted.</p>
</li>
<li>
<p>If you are mapping more than one source and destination network, you must create a <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.10/html/virtualization/virtual-machines#virt-creating-network-attachment-definition">network attachment definition</a> for each additional destination network.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="ports_forklift">Ports</h4>
<div class="paragraph">
<p>The firewalls must enable traffic over the following ports:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Network ports required for migrating from VMware vSphere</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 33.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VMware vCenter</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>VMware provider inventory</p>
</div>
<div class="paragraph">
<p>Disk transfer authentication</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VMware ESXi hosts</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Disk transfer authentication</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">902</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VMware ESXi hosts</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Disk transfer data copy</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Network ports required for migrating from oVirt</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 33.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>oVirt provider inventory</p>
</div>
<div class="paragraph">
<p>Disk transfer authentication</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt hosts</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Disk transfer authentication</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">54322</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt hosts</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Disk transfer data copy</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="source-vm-prerequisites_forklift">Source virtual machine prerequisites</h3>
<div class="paragraph">
<p>The following prerequisites apply to all migrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ISO/CDROM disks must be unmounted.</p>
</li>
<li>
<p>Each NIC must contain one IPv4 and/or one IPv6 address.</p>
</li>
<li>
<p>The VM operating system must be certified and supported for use as a <a href="https://access.redhat.com/articles/973163#ocpvirt">guest operating system with KubeVirt</a>.</p>
</li>
<li>
<p>VM names must contain only lowercase letters (<code>a-z</code>), numbers (<code>0-9</code>), or hyphens (<code>-</code>), up to a maximum of 253 characters. The first and last characters must be alphanumeric. The name must not contain uppercase letters, spaces, periods (<code>.</code>), or special characters.</p>
</li>
<li>
<p>VM names must not duplicate the name of a VM in the KubeVirt environment.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Forklift automatically assigns a new name to a VM that does not comply with the rules.</p>
</div>
<div class="paragraph">
<p>Forklift makes the following changes when it automatically generates a new VM name:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Excluded characters are removed.</p>
</li>
<li>
<p>Uppercase letters are switched to lowercase letters.</p>
</li>
<li>
<p>Any underscore (<code>_</code>) is changed to a dash (<code>-</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This feature allows a migration to proceed smoothly even if someone entered a VM name that does not follow the rules.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="rhv-prerequisites_forklift">oVirt prerequisites</h3>
<div class="paragraph">
<p>The following prerequisites apply to oVirt migrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To create a source provider, you must have at least the <code>UserRole</code> and <code>ReadOnlyAdmin</code> roles assigned to you. These are the minimum required permissions, however, any other administrator or superuser permissions will also work.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must keep the <code>UserRole</code> and <code>ReadOnlyAdmin</code> roles until the virtual machines of the source provider have been migrated. Otherwise, the migration will fail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>To migrate virtual machines:</p>
<div class="ulist">
<ul>
<li>
<p>You must have one of the following:</p>
<div class="ulist">
<ul>
<li>
<p>oVirt admin permissions. These permissions allow you to migrate any virtual machine in the system.</p>
</li>
<li>
<p><code>DiskCreator</code> and <code>UserVmManager</code> permissions on every virtual machine you want to migrate.</p>
</li>
</ul>
</div>
</li>
<li>
<p>You must use a <a href="#compatibility-guidelines_forklift">compatible version</a> of oVirt.</p>
</li>
<li>
<p>You must have the Engine CA certificate, unless it was replaced by a third-party certificate, in which case, specify the Engine Apache CA certificate.</p>
<div class="paragraph">
<p>You can obtain the Engine  CA certificate by navigating to <a href="https://&lt;engine_host&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA" class="bare">https://&lt;engine_host&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</a> in a browser.</p>
</div>
</li>
<li>
<p>If you are migrating a virtual machine with a direct LUN disk, ensure that the nodes in the KubeVirt destination cluster that the VM is expected to run on can access the backend storage.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Unlike disk images that <em>are copied</em> from a source provider to a target provider, LUNs are <em>detached</em>, <em>but not removed</em>, from virtual machines in the source provider and then attached to the virtual machines (VMs) that are created in the target provider.</p>
</li>
<li>
<p>LUNs are not removed from the source provider during the migration in case fallback to the source provider is required. However, before re-attaching the LUNs to VMs in the source provider, ensure that the LUNs are not used by VMs on the target environment at the same time, which might lead to data corruption.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="openstack-prerequisites_forklift">OpenStack prerequisites</h3>
<div class="paragraph">
<p>The following prerequisites apply to OpenStack migrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must use a <a href="#compatibility-guidelines_forklift">compatible version</a> of OpenStack.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="additional-authentication-for-osp_forklift">Additional authentication methods for migrations with OpenStack source providers</h4>
<div class="paragraph">
<p>Forklift versions 2.6 and later support the following authentication methods for migrations with OpenStack source providers in addition to the standard username and password credential set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Token authentication</p>
</li>
<li>
<p>Application credential authentication</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use these methods to migrate virtual machines with OpenStack source providers using the CLI the same way you migrate other virtual machines, except for how you prepare the <code>Secret</code> manifest.</p>
</div>
<div class="sect4">
<h5 id="openstack-token-authentication_forklift">Using token authentication with an OpenStack source provider</h5>
<div class="paragraph">
<p>You can use token authentication, instead of username and password authentication, when you create an OpenStack source provider.</p>
</div>
<div class="paragraph">
<p>Forklift supports both of the following types of token authentication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Token with user ID</p>
</li>
<li>
<p>Token with user name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each type of token authentication, you need to use data from OpenStack to create a <code>Secret</code> manifest.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Have an OpenStack account.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the dashboard of the OpenStack web console, click <strong>Project &gt; API Access</strong>.</p>
</li>
<li>
<p>Expand <strong>Download OpenStack RC file</strong> and click <strong>OpenStack RC file</strong>.</p>
<div class="paragraph">
<p>The file that is downloaded, referred to here as <code>&lt;openstack_rc_file&gt;</code>, includes the following fields used for token authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">OS_AUTH_URL
OS_PROJECT_ID
OS_PROJECT_NAME
OS_DOMAIN_NAME
OS_USERNAME</code></pre>
</div>
</div>
</li>
<li>
<p>To get the data needed for token authentication, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ openstack token issue</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output, referred to here as <code>&lt;openstack_token_output&gt;</code>, includes the <code>token</code>, <code>userID</code>, and <code>projectID</code> that you need for authentication using a token with user ID.</p>
</div>
</li>
<li>
<p>Create a <code>Secret</code> manifest similar to the following:</p>
<div class="ulist">
<ul>
<li>
<p>For authentication using a token with user ID:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: openstack-secret-tokenid
  namespace: openshift-mtv
  labels:
    createdForProviderType: openstack
type: Opaque
stringData:
  authType: token
  token: &lt;token_from_openstack_token_output&gt;
  projectID: &lt;projectID_from_openstack_token_output&gt;
  userID: &lt;userID_from_openstack_token_output&gt;
  url: &lt;OS_AUTH_URL_from_openstack_rc_file&gt;
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>For authentication using a token with user name:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: openstack-secret-tokenname
  namespace: openshift-mtv
  labels:
    createdForProviderType: openstack
type: Opaque
stringData:
  authType: token
  token: &lt;token_from_openstack_token_output&gt;
  domainName: &lt;OS_DOMAIN_NAME_from_openstack_rc_file&gt;
  projectName: &lt;OS_PROJECT_NAME_from_openstack_rc_file&gt;
  username: &lt;OS_USERNAME_from_openstack_rc_file&gt;
  url: &lt;OS_AUTH_URL_from_openstack_rc_file&gt;
EOF</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Continue migrating your virtual machine according to the procedure in <a href="#new-migrating-virtual-machines-cli_ostack">Migrating virtual machines</a>, starting with step 2, "Create a <code>Provider</code> manifest for the source provider."</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="openstack-application-credential-authentication_forklift">Using application credential authentication with an OpenStack source provider</h5>
<div class="paragraph">
<p>You can use application credential authentication, instead of username and password authentication, when you create an OpenStack source provider.</p>
</div>
<div class="paragraph">
<p>Forklift supports both of the following types of application credential authentication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application credential ID</p>
</li>
<li>
<p>Application credential name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For each type of application credential authentication, you need to use data from OpenStack to create a <code>Secret</code> manifest.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>You have an OpenStack account.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the dashboard of the OpenStack web console, click <strong>Project</strong> &gt; <strong>API Access</strong>.</p>
</li>
<li>
<p>Expand <strong>Download OpenStack RC file</strong> and click <strong>OpenStack RC file</strong>.</p>
<div class="paragraph">
<p>The file that is downloaded, referred to here as <code>&lt;openstack_rc_file&gt;</code>, includes the following fields used for application credential authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">OS_AUTH_URL
OS_PROJECT_ID
OS_PROJECT_NAME
OS_DOMAIN_NAME
OS_USERNAME</code></pre>
</div>
</div>
</li>
<li>
<p>To get the data needed for application credential authentication, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ openstack application credential create --role member --role reader --secret redhat forklift</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output, referred to here as <code>&lt;openstack_credential_output&gt;</code>, includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>id</code>  and <code>secret</code> that you need for authentication using an application credential ID</p>
</li>
<li>
<p>The <code>name</code> and <code>secret</code> that you need for authentication using an application credential name</p>
</li>
</ul>
</div>
</li>
<li>
<p>Create a <code>Secret</code> manifest similar to the following:</p>
<div class="ulist">
<ul>
<li>
<p>For authentication using the application credential ID:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: openstack-secret-appid
  namespace: openshift-mtv
  labels:
    createdForProviderType: openstack
type: Opaque
stringData:
  authType: applicationcredential
  applicationCredentialID: &lt;id_from_openstack_credential_output&gt;
  applicationCredentialSecret: &lt;secret_from_openstack_credential_output&gt;
  url: &lt;OS_AUTH_URL_from_openstack_rc_file&gt;
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>For authentication using the application credential name:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">cat &lt;&lt; EOF | oc apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: openstack-secret-appname
  namespace: openshift-mtv
  labels:
    createdForProviderType: openstack
type: Opaque
stringData:
  authType: applicationcredential
  applicationCredentialName: &lt;name_from_openstack_credential_output&gt;
  applicationCredentialSecret: &lt;secret_from_openstack_credential_output&gt;
  domainName: &lt;OS_DOMAIN_NAME_from_openstack_rc_file&gt;
  username: &lt;OS_USERNAME_from_openstack_rc_file&gt;
  url: &lt;OS_AUTH_URL_from_openstack_rc_file&gt;
EOF</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Continue migrating your virtual machine according to the procedure in <a href="#new-migrating-virtual-machines-cli_ostack">Migrating virtual machines</a>, starting with step 2, "Create a <code>Provider</code> manifest for the source provider."</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="vmware-prerequisites_forklift">VMware prerequisites</h3>
<div class="paragraph">
<p>It is strongly recommended to create a VDDK image to accelerate migrations. For more information, see <a href="#../master.adoc#creating-vddk-image_mtv">Creating a VDDK image</a>.</p>
</div>
<div class="paragraph">
<p>The following prerequisites apply to VMware migrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must use a <a href="#compatibility-guidelines_forklift">compatible version</a> of VMware vSphere.</p>
</li>
<li>
<p>You must be logged in as a user with at least the minimal set of <a href="#vmware-privileges_forklift">VMware privileges</a>.</p>
</li>
<li>
<p>To access the virtual machine using a pre-migration hook, <a href="https://www.vmware.com/support/ws5/doc/new_guest_tools_ws.html">VMware Tools</a> must be installed on the source virtual machine.</p>
</li>
<li>
<p>The VM operating system must be certified and supported for use as a <a href="https://access.redhat.com/articles/973163#ocpvirt">guest operating system with KubeVirt</a> <em>and</em> for <a href="https://access.redhat.com/articles/1351473">conversion to KVM with <code>virt-v2v</code></a>.</p>
</li>
<li>
<p>If you are running a warm migration, you must enable <a href="https://kb.vmware.com/s/article/1020128">changed block tracking (CBT)</a> on the VMs and on the VM disks.</p>
</li>
<li>
<p>If you are migrating more than 10 VMs from an ESXi host in the same migration plan, you must increase the NFC service memory of the host.</p>
</li>
<li>
<p>It is strongly recommended to disable hibernation because Forklift does not support migrating hibernated VMs.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the event of a power outage, data might be lost for a VM with disabled hibernation. However, if hibernation is not disabled, migration will fail</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Neither Forklift nor OpenShift Virtualization support conversion of Btrfs for migrating VMs from VMWare.</p>
</div>
</td>
</tr>
</table>
</div>
<h4 id="vmware-privileges_forklift" class="discrete">VMware privileges</h4>
<div class="paragraph">
<p>The following minimal set of VMware privileges is required to migrate virtual machines to KubeVirt with the Forklift.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. VMware privileges</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Privilege</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code>Virtual machine.Interaction</code> privileges:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Interaction.Power Off</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows powering off a powered-on virtual machine. This operation powers down the guest operating system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Interaction.Power On</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows powering on a powered-off virtual machine and resuming a suspended virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><div class="content"><div class="paragraph">
<p><code>Virtual machine.Provisioning</code> privileges:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All <code>Virtual machine.Provisioning</code> privileges are required.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Allow disk access</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows opening a disk on a virtual machine for random read and write access. Used mostly for remote disk mounting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Allow file access</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows operations on files associated with a virtual machine, including VMX, disks, logs, and NVRAM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Allow read-only disk access</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows opening a disk on a virtual machine for random read access. Used mostly for remote disk mounting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Allow virtual machine download</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows read operations on files associated with a virtual machine, including VMX, disks, logs, and NVRAM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Allow virtual machine files upload</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows write operations on files associated with a virtual machine, including VMX, disks, logs, and NVRAM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Clone template</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows cloning of a template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Clone virtual machine</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows cloning of an existing virtual machine and allocation of resources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Create template from virtual machine</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows creation of a new template from a virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Customize guest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows customization of a virtual machine’s guest operating system without moving the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Deploy template</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows deployment of a virtual machine from a template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Mark as template</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows marking an existing powered-off virtual machine as a template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Mark as virtual machine</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows marking an existing template as a virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Modify customization specification</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows creation, modification, or deletion of customization specifications.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Promote disks</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows promote operations on a virtual machine&#8217;s disks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Provisioning.Read customization specifications</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows reading a customization specification.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code>Virtual machine.Snapshot management</code> privileges:</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Snapshot management.Create snapshot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows creation of a snapshot from the virtual machine’s current state.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Virtual machine.Snapshot management.Remove Snapshot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows removal of a snapshot from the snapshot history.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="creating-vddk-image_forklift">Creating a VDDK image</h4>
<div class="paragraph">
<p> Forklift uses the VMware Virtual Disk Development Kit (VDDK) SDK to accelerate transferring virtual disks from VMware vSphere. Therefore, creating a VDDK image, although optional, is highly recommended.</p>
</div>
<div class="paragraph">
<p>To make use of this feature, you download the VMware Virtual Disk Development Kit (VDDK), build a VDDK image, and push the VDDK image to your image registry.</p>
</div>
<div class="paragraph">
<p>The VDDK package contains symbolic links, therefore, the procedure of creating a VDDK image must be performed on a file system that preserves symbolic links (symlinks).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Storing the VDDK image in a public registry might violate the VMware license terms.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.10/html/registry/setting-up-and-configuring-the-registry#configuring-registry-storage-baremetal">OKD image registry</a>.</p>
</li>
<li>
<p><code>podman</code> installed.</p>
</li>
<li>
<p>You are working on a file system that preserves symbolic links (symlinks).</p>
</li>
<li>
<p>If you are using an external registry, KubeVirt must be able to access it.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create and navigate to a temporary directory:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ mkdir /tmp/&lt;dir_name&gt; &amp;&amp; cd /tmp/&lt;dir_name&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In a browser, navigate to the <a href="https://developer.vmware.com/web/sdk/8.0/vddk">VMware VDDK version 8 download page</a>.</p>
</li>
<li>
<p>Select version 8.0.1 and click <strong>Download</strong>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order to migrate to KubeVirt 4.12, download VDDK version 7.0.3.2 from the <a href="https://developer.vmware.com/web/sdk/7.0/vddk">VMware VDDK version 7 download page</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Save the VDDK archive file in the temporary directory.</p>
</li>
<li>
<p>Extract the VDDK archive:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ tar -xzf VMware-vix-disklib-&lt;version&gt;.x86_64.tar.gz</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>Dockerfile</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &gt; Dockerfile &lt;&lt;EOF
FROM registry.access.redhat.com/ubi8/ubi-minimal
USER 1001
COPY vmware-vix-disklib-distrib /vmware-vix-disklib-distrib
RUN mkdir -p /opt
ENTRYPOINT ["cp", "-r", "/vmware-vix-disklib-distrib", "/opt"]
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Build the VDDK image:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ podman build . -t &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Push the VDDK image to the registry:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ podman push &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that the image is accessible to your KubeVirt environment.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="increasing-nfc-memory-vmware-host_forklift">Increasing the NFC service memory of an ESXi host</h4>
<div class="paragraph">
<p>If you are migrating more than 10 VMs from an ESXi host in the same migration plan, you must increase the NFC service memory of the host. Otherwise, the migration will fail because the NFC service memory is limited to 10 parallel connections.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the ESXi host as root.</p>
</li>
<li>
<p>Change the value of <code>maxMemory</code> to <code>1000000000</code> in <code>/etc/vmware/hostd/config.xml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">...
      &lt;nfcsvc&gt;
         &lt;path&gt;libnfcsvc.so&lt;/path&gt;
         &lt;enabled&gt;true&lt;/enabled&gt;
         &lt;maxMemory&gt;1000000000&lt;/maxMemory&gt;
         &lt;maxStreamMemory&gt;10485760&lt;/maxStreamMemory&gt;
      &lt;/nfcsvc&gt;
...</code></pre>
</div>
</div>
</li>
<li>
<p>Restart <code>hostd</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal"># /etc/init.d/hostd restart</code></pre>
</div>
</div>
<div class="paragraph">
<p>You do not need to reboot the host.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ova-prerequisites_forklift">Open Virtual Appliance (OVA) prerequisites</h3>
<div class="paragraph">
<p>The following prerequisites apply to Open Virtual Appliance (OVA) file migrations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All OVA files are created by VMware vSphere.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Migration of OVA files that were not created by VMware vSphere but are compatible with vSphere might succeed. However, migration of such files is not supported by Forklift. Forklift supports only OVA files created by VMware vSphere.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>The OVA files are in one or more folders under an NFS shared directory in one of the following structures:</p>
<div class="ulist">
<ul>
<li>
<p>In one or more compressed Open Virtualization Format (OVF) packages that hold all the VM information.</p>
<div class="paragraph">
<p>The filename of each compressed package <strong>must</strong> have the <code>.ova</code> extension. Several compressed packages can be stored in the same folder.</p>
</div>
<div class="paragraph">
<p>When this structure is used, Forklift scans the root folder and the first-level subfolders for compressed packages.</p>
</div>
<div class="paragraph">
<p>For example, if the NFS share is, <code>/nfs</code>, then:<br>
The folder <code>/nfs</code> is scanned.<br>
The folder <code>/nfs/subfolder1</code> is scanned.<br>
But, <code>/nfs/subfolder1/subfolder2</code> is not scanned.</p>
</div>
</li>
<li>
<p>In extracted OVF packages.</p>
<div class="paragraph">
<p>When this structure is used, Forklift scans the root folder, first-level subfolders, and second-level subfolders for extracted OVF packages.
However, there can be only one <code>.ovf</code> file in a folder. Otherwise, the migration will fail.</p>
</div>
<div class="paragraph">
<p>For example, if the NFS share is, <code>/nfs</code>, then:<br>
The OVF file <code>/nfs/vm.ovf</code> is scanned.<br>
The OVF file <code>/nfs/subfolder1/vm.ovf</code> is scanned.<br>
The OVF file <code>/nfs/subfolder1/subfolder2/vm.ovf</code> is scanned.<br>
But, the OVF file <code>/nfs/subfolder1/subfolder2/subfolder3/vm.ovf</code> is not scanned.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="compatibility-guidelines_forklift">Software compatibility guidelines</h3>
<div class="paragraph">
<p>You must install compatible software versions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Compatible software versions</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Forklift</th>
<th class="tableblock halign-left valign-top">OKD</th>
<th class="tableblock halign-left valign-top">KubeVirt</th>
<th class="tableblock halign-left valign-top">VMware vSphere</th>
<th class="tableblock halign-left valign-top">oVirt</th>
<th class="tableblock halign-left valign-top">OpenStack</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.10 or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.10 or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6.5 or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.4 SP1 or later</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16.1 or later</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Migration from oVirt 4.3</div>
<div class="paragraph">
<p>MTV 2.5 was tested only with oVirt (RHV) 4.4 SP1.
Migration from oVirt (oVirt) 4.3 has not been tested with Forklift 2.3.</p>
</div>
<div class="paragraph">
<p>As oVirt 4.3 lacks the improvements that were introduced in oVirt 4.4 for Forklift, and new features were not tested with oVirt 4.3, migrations from oVirt 4.3 may not function at the same level as migrations from oVirt 4.4, with some functionality may be missing.</p>
</div>
<div class="paragraph">
<p>Therefore, it is recommended to upgrade oVirt to the supported version above before the migration to KubeVirt.</p>
</div>
<div class="paragraph">
<p>However, migrations from oVirt 4.3.11 were tested with Forklift 2.3, and may work in practice in many environments using Forklift 2.3. In this case, we advise upgrading oVirt Manager (RHVM) to the previously mentioned supported version before the migration to KubeVirt.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="openshift-operator-life-cycles">OpenShift Operator Life Cycles</h4>
<div class="paragraph">
<p>For more information about the software maintenance Life Cycle classifications for Operators shipped by Red Hat for use with OpenShift Container Platform, see <a href="https://access.redhat.com/support/policy/updates/openshift_operators#platform-agnostic">OpenShift Operator Life Cycles</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-the-operator_forklift">Installing and configuring the Forklift Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can install the Forklift Operator by using the OKD web console or the command line interface (CLI).</p>
</div>
<div class="paragraph">
<p>In Forklift version 2.4 and later, the Forklift Operator includes the Forklift plugin for the OKD web console.</p>
</div>
<div class="paragraph">
<p>After you install the Forklift Operator by using either the OKD web console or the CLI, you can configure the Operator.</p>
</div>
<div class="sect2">
<h3 id="installing-mtv-operator_forklift">Installing the Forklift Operator by using the OKD web console</h3>
<div class="paragraph">
<p>You can install the Forklift Operator by using the OKD web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>OKD 4.10 or later installed.</p>
</li>
<li>
<p>KubeVirt Operator installed on an OpenShift migration target cluster.</p>
</li>
<li>
<p>You must be logged in as a user with <code>cluster-admin</code> permissions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Operators</strong> &#8594; <strong>OperatorHub</strong>.</p>
</li>
<li>
<p>Use the <strong>Filter by keyword</strong> field to search for <strong>forklift-operator</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Forklift Operator is a Community Operator. Red Hat does not support Community Operators.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Migration Toolkit for Virtualization Operator</strong> and then click <strong>Install</strong>.</p>
</li>
<li>
<p>Click <strong>Create ForkliftController</strong> when the button becomes active.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
<div class="paragraph">
<p>Your ForkliftController appears in the list that is displayed.</p>
</div>
</li>
<li>
<p>Click <strong>Workloads</strong> &#8594; <strong>Pods</strong> to verify that the Forklift pods are running.</p>
</li>
<li>
<p>Click <strong>Operators</strong> &#8594; <strong>Installed Operators</strong> to verify that <strong>Migration Toolkit for Virtualization Operator</strong> appears in the <strong>konveyor-forklift</strong> project with the status <strong>Succeeded</strong>.</p>
<div class="paragraph">
<p>When the plugin is ready you will be prompted to reload the page.  The  <strong>Migration</strong> menu item is automatically added to the navigation bar, displayed on the left of the OKD web console.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="installing-mtv-operator_forklift">Installing the Forklift Operator from the command line interface</h3>
<div class="paragraph">
<p>You can install the Forklift Operator from the command line interface (CLI).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>OKD 4.10 or later installed.</p>
</li>
<li>
<p>KubeVirt Operator installed on an OpenShift migration target cluster.</p>
</li>
<li>
<p>You must be logged in as a user with <code>cluster-admin</code> permissions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the konveyor-forklift project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: project.openshift.io/v1
kind: Project
metadata:
  name: konveyor-forklift
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Create an <code>OperatorGroup</code> CR called <code>migration</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: operators.coreos.com/v1
kind: OperatorGroup
metadata:
  name: migration
  namespace: konveyor-forklift
spec:
  targetNamespaces:
    - konveyor-forklift
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>Subscription</code> CR for the Operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: forklift-operator
  namespace: konveyor-forklift
spec:
  channel: development
  installPlanApproval: Automatic
  name: forklift-operator
  source: community-operators
  sourceNamespace: openshift-marketplace
  startingCSV: "konveyor-forklift-operator.2.3.0"
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>ForkliftController</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: ForkliftController
metadata:
  name: forklift-controller
  namespace: konveyor-forklift
spec:
  olm_managed: true
EOF</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that the Forklift pods are running:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl get pods -n konveyor-forklift</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre>NAME                                                    READY   STATUS    RESTARTS   AGE
forklift-api-bb45b8db4-cpzlg                            1/1     Running   0          6m34s
forklift-controller-7649db6845-zd25p                    2/2     Running   0          6m38s
forklift-must-gather-api-78fb4bcdf6-h2r4m               1/1     Running   0          6m28s
forklift-operator-59c87cfbdc-pmkfc                      1/1     Running   0          28m
forklift-ui-plugin-5c5564f6d6-zpd85                     1/1     Running   0          6m24s
forklift-validation-7d84c74c6f-fj9xg                    1/1     Running   0          6m30s
forklift-volume-populator-controller-85d5cb64b6-mrlmc   1/1     Running   0          6m36s</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-mtv-operator_forklift">Configuring the Forklift Operator</h3>
<div class="paragraph">
<p>You can configure all of the following settings of the Forklift Operator by modifying the <code>ForkliftController</code> CR, or in the <strong>Settings</strong> section of the <strong>Overview</strong> page, unless otherwise indicated.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maximum number of virtual machines (VMs) per plan that can be migrated simultaneously.</p>
</li>
<li>
<p>How long <code>must gather</code> reports are retained before being automatically deleted.</p>
</li>
<li>
<p>CPU limit allocated to the main controller container.</p>
</li>
<li>
<p>Memory limit allocated to the main controller container.</p>
</li>
<li>
<p>Interval at which a new snapshot is requested before initiating a warm migration.</p>
</li>
<li>
<p>Frequency with which the system checks the status of snapshot creation or removal during a warm migration.</p>
</li>
<li>
<p>Percentage of space in persistent volumes allocated as file system overhead when the <code>storageclass</code> is <code>filesystem</code> (<code>ForkliftController</code> CR only).</p>
</li>
<li>
<p>Fixed amount of additional space allocated in persistent block volumes. This setting is applicable for any <code>storageclass</code> that is block-based (<code>ForkliftController</code> CR only).</p>
</li>
<li>
<p>Configuration map of operating systems to preferences for vSphere source providers (<code>ForkliftController</code> CR only).</p>
</li>
<li>
<p>Configuration map of operating systems to preferences for oVirt (oVirt) source providers (<code>ForkliftController</code> CR only).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The procedure for configuring these settings using the user interface is presented in <a href="#mtv-overview-page_forklift">Configuring MTV settings</a>. The procedure for configuring these settings by modifying the <code>ForkliftController</code> CR is presented following.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Change a parameter&#8217;s value in  the <code>spec</code> portion of the <code>ForkliftController</code> CR by adding the label and value as follows:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>spec:
  label: value <i class="conum" data-value="1"></i><b>(1)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Labels you can configure using the CLI are shown in the table that follows, along with a description of each label and its default value.</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Forklift Operator labels</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Label</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>controller_max_vm_inflight</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of VMs per plan that can be migrated simultaneously.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>must_gather_api_cleanup_max_age</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The duration in hours for retaining <code>must gather</code> reports before they are automatically deleted.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-1</code> (disabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>controller_container_limits_cpu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CPU limit allocated to the main controller container.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>500m</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>controller_container_limits_memory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The memory limit allocated to the main controller container.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>800Mi</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>controller_precopy_interval</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interval in minutes at which a new snapshot is requested before initiating a warm migration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>60</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>controller_snapshot_status_check_rate_seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The frequency in seconds with which the system checks the status of snapshot creation or removal during a warm migration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>controller_filesystem_overhead</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Percentage of space in persistent volumes allocated as file system overhead when the <code>storageclass</code> is <code>filesystem</code>.</p>
<p class="tableblock"><code>ForkliftController</code> CR only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>controller_block_overhead</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed amount of additional space allocated in persistent block volumes. This setting is applicable for any <code>storageclass</code> that is block-based. It can be used when data, such as encryption headers, is written to the persistent volumes in addition to the content of the virtual disk.</p>
<p class="tableblock"><code>ForkliftController</code> CR only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vsphere_osmap_configmap_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration map for vSphere source providers. This configuration map maps the operating system of the incoming VM to a KubeVirt preference name. This configuration map needs to be in the namespace where the Forklift Operator is deployed.</p>
<p class="tableblock">To see the list of preferences in your KubeVirt environment, open the OpenShift web console and click <strong>Virtualization</strong> &#8594; <strong>Preferences</strong>.</p>
<p class="tableblock">You can add values to the configuration map when this label has the default value, <code>forklift-vsphere-osmap.</code> In order to override or delete values, specify a configuration map that is different from <code>forklift-vsphere-osmap</code>.</p>
<p class="tableblock"><code>ForkliftController</code> CR only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forklift-vsphere-osmap</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ovirt_osmap_configmap_name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration map for oVirt source providers. This configuration map maps the operating system of the incoming VM to a KubeVirt preference name. This configuration map needs to be in the namespace where the Forklift Operator is deployed.</p>
<p class="tableblock">To see the list of preferences in your KubeVirt environment, open the OpenShift web console and click <strong>Virtualization</strong> &#8594; <strong>Preferences</strong>.</p>
<p class="tableblock">You can add values to the configuration map when this label has the default value, <code>forklift-ovirt-osmap.</code> In order to override or delete values, specify a configuration map that is different from <code>forklift-ovirt-osmap</code>.</p>
<p class="tableblock"><code>ForkliftController</code> CR only.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forklift-ovirt-osmap</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-vms-web-console_forklift">Migrating virtual machines by using the OKD web console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can migrate virtual machines (VMs) by using the OKD web console to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#adding-source-providers">Create source providers</a></p>
</li>
<li>
<p><a href="#adding-destination-providers">Create destination providers</a></p>
</li>
<li>
<p><a href="#creating-migration-plans-ui">Create migration plans</a></p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must ensure that all <a href="#prerequisites_forklift">prerequisites</a> are met.</p>
</div>
<div class="paragraph">
<p>VMware only: You must have the minimal set of <a href="#vmware-privileges_forklift">VMware privileges</a>.</p>
</div>
<div class="paragraph">
<p>VMware only: Creating a <a href="#creating-vddk-image_forklift">VMware Virtual Disk Development Kit (VDDK)</a> image will increase migration speed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="mtv-ui_forklift">The MTV user interface</h3>
<div class="paragraph">
<p>The Forklift user interface is integrated into the OKD web console.</p>
</div>
<div class="paragraph">
<p>In the left-hand panel, you can choose a page related to a component of the migration progress, for example, <strong>Providers for Migration</strong>, or, if you are an administrator, you can choose <strong>Overview</strong>, which contains information about migrations and lets you configure Forklift settings.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../modules/images/mtv-ui.png" alt="Forklift user interface">
</div>
<div class="title">Figure 1. Forklift extension interface</div>
</div>
<div class="paragraph">
<p>In pages related to components, you can click on the <strong>Projects</strong> list, which is in the upper-left portion of the page, and see which projects (namespaces) you are allowed to work with.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are an administrator, you can see all projects.</p>
</li>
<li>
<p>If you are a non-administrator, you can see only the projects that you have permissions to work with.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="mtv-overview-page_forklift">The MTV Overview page</h3>
<div class="paragraph">
<p>The Forklift <strong>Overview</strong> page displays system-wide information about migrations and a list of <strong>Settings</strong> you can change.</p>
</div>
<div class="paragraph">
<p>If you have Administrator privileges, you can access the <strong>Overview</strong> page by clicking <strong>Migration</strong> &#8594; <strong>Overview</strong> in the OKD web console.</p>
</div>
<div class="paragraph">
<p>The <strong>Overview</strong> page has 3 tabs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Overview</p>
</li>
<li>
<p>YAML</p>
</li>
<li>
<p>Metrics</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="overview-tab_forklift">Overview tab</h4>
<div class="paragraph">
<p>The <strong>Overview</strong> tab lets you see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Operator: The namespace on which the Forklift Operator is deployed and the status of the Operator</p>
</li>
<li>
<p>Pods: The name, status, and creation time of each pod that was deployed by the Forklift Operator</p>
</li>
<li>
<p>Conditions: Status of the Forklift Operator:</p>
<div class="ulist">
<ul>
<li>
<p>Failure: Last failure. <code>False</code> indicates no failure since deployment.</p>
</li>
<li>
<p>Running: Whether the Operator is currently running and waiting for the next reconciliation.</p>
</li>
<li>
<p>Successful: Last successful reconciliation.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="yaml-tab_forklift">YAML tab</h4>
<div class="paragraph">
<p>The custom resource ForkliftController that defines the operation of the Forklift Operator. You can modify the custom resource from this tab.</p>
</div>
</div>
<div class="sect3">
<h4 id="metrics-tab_forklift">Metrics tab</h4>
<div class="paragraph">
<p>The <strong>Metrics</strong> tab lets you see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Migrations: The number of migrations performed using Forklift:</p>
<div class="ulist">
<ul>
<li>
<p>Total</p>
</li>
<li>
<p>Running</p>
</li>
<li>
<p>Failed</p>
</li>
<li>
<p>Succeeded</p>
</li>
<li>
<p>Canceled</p>
</li>
</ul>
</div>
</li>
<li>
<p>Virtual Machine Migrations:  The number of VMs migrated using Forklift:</p>
<div class="ulist">
<ul>
<li>
<p>Total</p>
</li>
<li>
<p>Running</p>
</li>
<li>
<p>Failed</p>
</li>
<li>
<p>Succeeded</p>
</li>
<li>
<p>Canceled</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since a single migration might involve many virtual machines, the number of migrations performed using Forklift might vary significantly from the number of virtual machines that have been migrated using Forklift.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Chart showing the number of running, failed, and succeeded migrations performed using Forklift for each of the last 7 days</p>
</li>
<li>
<p>Chart showing the number of running, failed, and succeeded virtual machine migrations performed using Forklift for each of the last 7 days</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mtv-settings_forklift">Configuring MTV settings</h3>
<div class="paragraph">
<p>If you have Administrator privileges, you can access the <strong>Overview</strong> page and change the following settings in it:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Forklift settings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max concurrent virtual machine migrations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of VMs per plan that can be migrated simultaneously</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must gather cleanup after (hours)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The duration for retaining <code>must gather</code> reports before they are automatically deleted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controller main container CPU limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The CPU limit allocated to the main controller container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controller main container Memory limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The memory limit allocated to the main controller container</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">800 Mi</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Precopy internal (minutes)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interval at which a new snapshot is requested before initiating a warm migration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snapshot polling interval (seconds)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The frequency with which the system checks the status of snapshot creation or removal during a warm migration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Overview</strong>. The <strong>Settings</strong> list is on the right-hand side of the page.</p>
</li>
<li>
<p>In the <strong>Settings</strong> list, click the Edit icon of the setting you want to change.</p>
</li>
<li>
<p>Choose a setting from the list.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-providers">Adding providers</h3>
<div class="paragraph">
<p>You can add source providers and destination providers for a virtual machine migration by using the OKD web console.</p>
</div>
<div class="sect3">
<h4 id="adding-source-providers">Adding source providers</h4>
<div class="paragraph">
<p>You can use Forklift to migrate VMs from the following source providers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VMware vSphere</p>
</li>
<li>
<p>oVirt</p>
</li>
<li>
<p>OpenStack</p>
</li>
<li>
<p>Open Virtual Appliances (OVAs) that were created by VMware vSphere</p>
</li>
<li>
<p>KubeVirt</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can add a source provider by using the OKD web console.</p>
</div>
<div class="sect4">
<h5 id="adding-source-provider_forklift">Adding a VMware vSphere source provider</h5>
<div class="paragraph">
<p>You can migrate VMware vSphere VMs from VMware vCenter or from a VMWare ESX/ESXi server. In Forklift versions 2.6 and later, you can migrate directly from an ESX/ESXi server, without going through vCenter, by specifying the SDK endpoint to that of an ESX/ESXi server.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>EMS enforcement is disabled for migrations with VMware vSphere source providers in order to enable migrations from versions of vSphere that are supported by Forklift but do not comply with the 2023 FIPS requirements. Therefore, users should consider whether migrations from vSphere source providers risk their compliance with FIPS. Supported versions of vSphere are specified in <a href="#../master.adoc#compatibility-guidelines_mtv">Software compatibility guidelines</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>It is strongly recommended to create a VMware Virtual Disk Development Kit (VDDK) image in a secure registry that is accessible to all clusters. A VDDK image accelerates migration. For more information, see <a href="#../master.adoc#creating-vddk-image_mtv">Creating a VDDK image</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Providers for virtualization</strong>.</p>
</li>
<li>
<p>Click <strong>Create Provider</strong>.</p>
</li>
<li>
<p>Click <strong>vSphere</strong>.</p>
</li>
<li>
<p>Specify the following fields:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Provider Details</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Provider resource name</strong>: Name of the source provider.</p>
</li>
<li>
<p><strong>Endpoint type</strong>: Select the vSphere provider endpoint type. Options: <strong>vCenter</strong> or <strong>ESXi</strong>. You can migrate virtual machines from vCenter, an ESX/ESXi server that is not managed by vCenter, or from an ESX/ESXi server that is managed by vCenter but does not go through vCenter.</p>
</li>
<li>
<p><strong>URL</strong>: URL of the SDK endpoint of the vCenter on which the source VM is mounted. Ensure that the URL includes the <code>sdk</code> path, usually <code>/sdk</code>. For example, <code>https://vCenter-host-example.com/sdk</code>. If a certificate for FQDN is specified, the value of this field needs to match the FQDN in the certificate.</p>
</li>
<li>
<p><strong>VDDK init image</strong>: <code>VDDKInitImage</code> path. It is strongly recommended to create a VDDK init image to accelerate migrations. For more information, see <a href="#../master.adoc#creating-vddk-image_mtv">Creating a VDDK image</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Provider details</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Username</strong>: vCenter user or ESXi user. For example, <code>user@vsphere.local</code>.</p>
</li>
<li>
<p><strong>Password</strong>: vCenter user password or ESXi user password.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Choose one of the following options for validating CA certificates:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Use a custom CA certificate</strong>: Migrate after validating a custom CA certificate.</p>
</li>
<li>
<p><strong>Use the system CA certificate</strong>: Migrate after validating the system CA certificate.</p>
</li>
<li>
<p><strong>Skip certificate validation</strong> : Migrate without validating a CA certificate.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To use a custom CA certificate, leave the <strong>Skip certificate validation</strong> switch toggled to left, and <em>either</em> drag the CA certificate to the text box <em>or</em> browse for it and click <strong>Select</strong>.</p>
</li>
<li>
<p>To use the system CA certificate, leave the <strong>Skip certificate validation</strong> switch toggled to the left, and leave the <strong>CA certificate</strong> text box empty.</p>
</li>
<li>
<p>To skip certificate validation, toggle the <strong>Skip certificate validation</strong> switch to the right.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: Ask Forklift to fetch a custom CA certificate from the provider&#8217;s API endpoint URL.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Fetch certificate from URL</strong>. The <strong>Verify certificate</strong> window opens.</p>
</li>
<li>
<p>If the details are correct, select the <strong>I trust the authenticity of this certificate</strong> checkbox, and then, click <strong>Confirm</strong>. If not, click <strong>Cancel</strong>, and then, enter the correct certificate information manually.</p>
<div class="paragraph">
<p>Once confirmed, the CA certificate will be used to validate subsequent communication with the API endpoint.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Create provider</strong> to add and save the provider.</p>
<div class="paragraph">
<p>The provider appears in the list of providers.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It might take a few minutes for the provider to have the status <code>Ready</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="selecting-migration-network-for-vmware-source-provider_forklift">Selecting a migration network for a VMware source provider</h6>
<div class="paragraph">
<p>You can select a migration network in the OKD web console for a source provider to reduce risk to the source environment and to improve performance.</p>
</div>
<div class="paragraph">
<p>Using the default network for migration can result in poor performance because the network might not have sufficient bandwidth. This situation can have a negative effect on the source platform because the disk transfer operation might saturate the network.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The migration network must have sufficient throughput, minimum speed of 10 Gbps, for disk transfer.</p>
</li>
<li>
<p>The migration network must be accessible to the KubeVirt nodes through the default gateway.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The source virtual disks are copied by a pod that is connected to the pod network of the target namespace.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The migration network must have jumbo frames enabled.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Providers for virtualization</strong>.</p>
</li>
<li>
<p>Click the host number in the <strong>Hosts</strong> column beside a provider to view a list of hosts.</p>
</li>
<li>
<p>Select one or more hosts and click <strong>Select migration network</strong>.</p>
</li>
<li>
<p>Specify the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Network</strong>: Network name</p>
</li>
<li>
<p><strong>ESXi host admin username</strong>: For example, <code>root</code></p>
</li>
<li>
<p><strong>ESXi host admin password</strong>: Password</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
<li>
<p>Verify that the status of each host is <strong>Ready</strong>.</p>
<div class="paragraph">
<p>If a host status is not <strong>Ready</strong>, the host might be unreachable on the migration network or the credentials might be incorrect. You can modify the host configuration and save the changes.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect4">
<h5 id="adding-source-provider_forklift">Adding an oVirt source provider</h5>
<div class="paragraph">
<p>You can add an oVirt source provider by using the OKD web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Engine CA certificate, unless it was replaced by a third-party certificate, in which case, specify the Engine Apache CA certificate</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Providers for virtualization</strong>.</p>
</li>
<li>
<p>Click <strong>Create Provider</strong>.</p>
</li>
<li>
<p>Click <strong>Red Hat Virtualization</strong></p>
</li>
<li>
<p>Specify the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Provider resource name</strong>: Name of the source provider.</p>
</li>
<li>
<p><strong>URL</strong>: URL of the API endpoint of the oVirt Manager (RHVM) on which the source VM is mounted. Ensure that the URL includes the path leading to the RHVM API server, usually <code>/ovirt-engine/api</code>. For example, <code>https://rhv-host-example.com/ovirt-engine/api</code>.</p>
</li>
<li>
<p><strong>Username</strong>: Username.</p>
</li>
<li>
<p><strong>Password</strong>: Password.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Choose one of the following options for validating CA certificates:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Use a custom CA certificate</strong>: Migrate after validating a custom CA certificate.</p>
</li>
<li>
<p><strong>Use the system CA certificate</strong>: Migrate after validating the system CA certificate.</p>
</li>
<li>
<p><strong>Skip certificate validation</strong> : Migrate without validating a CA certificate.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To use a custom CA certificate, leave the <strong>Skip certificate validation</strong> switch toggled to left, and <em>either</em> drag the CA certificate to the text box <em>or</em> browse for it and click <strong>Select</strong>.</p>
</li>
<li>
<p>To use the system CA certificate, leave the <strong>Skip certificate validation</strong> switch toggled to the left, and leave the <strong>CA certificate</strong> text box empty.</p>
</li>
<li>
<p>To skip certificate validation, toggle the <strong>Skip certificate validation</strong> switch to the right.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: Ask Forklift to fetch a custom CA certificate from the provider&#8217;s API endpoint URL.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Fetch certificate from URL</strong>. The <strong>Verify certificate</strong> window opens.</p>
</li>
<li>
<p>If the details are correct, select the <strong>I trust the authenticity of this certificate</strong> checkbox, and then, click <strong>Confirm</strong>. If not, click <strong>Cancel</strong>, and then, enter the correct certificate information manually.</p>
<div class="paragraph">
<p>Once confirmed, the CA certificate will be used to validate subsequent communication with the API endpoint.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Create provider</strong> to add and save the provider.</p>
<div class="paragraph">
<p>The provider appears in the list of providers.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="adding-source-provider_forklift">Adding an OpenStack source provider</h5>
<div class="paragraph">
<p>You can add an OpenStack source provider by using the OKD web console.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you migrate an image-based VM from an OpenStack provider, a snapshot is created for the image that is attached to the source VM and the data from the snapshot is copied over to the target VM. This means that the target VM will have the same state as that of the source VM at the time the snapshot was created.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Providers for virtualization</strong>.</p>
</li>
<li>
<p>Click <strong>Create Provider</strong>.</p>
</li>
<li>
<p>Click <strong>OpenStack</strong>.</p>
</li>
<li>
<p>Specify the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Provider resource name</strong>: Name of the source provider.</p>
</li>
<li>
<p><strong>URL</strong>: URL of the OpenStack Identity (Keystone) endpoint. For example, <code>http://controller:5000/v3</code>.</p>
</li>
<li>
<p><strong>Authentication type</strong>: Choose one of the following methods of authentication and supply the information related to your choice. For example, if you choose <strong>Application credential ID</strong> as the authentication type, the <strong>Application credential ID</strong> and the <strong>Application credential secret</strong> fields become active, and you need to supply the ID and the secret.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Application credential ID</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Application credential ID</strong>: OpenStack application credential ID</p>
</li>
<li>
<p><strong>Application credential secret</strong>: OpenStack <a href="https://github.com/kubev2v/forklift-documentation/pull/402pplication" class="bare">https://github.com/kubev2v/forklift-documentation/pull/402pplication</a> credential <code>Secret</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Application credential name</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Application credential name</strong>: OpenStack application credential name</p>
</li>
<li>
<p><strong>Application credential secret</strong>: : OpenStack application credential <code>Secret</code></p>
</li>
<li>
<p><strong>Username</strong>: OpenStack username</p>
</li>
<li>
<p><strong>Domain</strong>: OpenStack domain name</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Token with user ID</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Token</strong>: OpenStack token</p>
</li>
<li>
<p><strong>User ID</strong>: OpenStack user ID</p>
</li>
<li>
<p><strong>Project ID</strong>:  OpenStack project ID</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Token with user Name</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Token</strong>: OpenStack token</p>
</li>
<li>
<p><strong>Username</strong>: OpenStack username</p>
</li>
<li>
<p><strong>Project</strong>: OpenStack project</p>
</li>
<li>
<p><strong>Domain name</strong>: OpenStack domain name</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Password</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Username</strong>: OpenStack username</p>
</li>
<li>
<p><strong>Password</strong>: OpenStack password</p>
</li>
<li>
<p><strong>Project</strong>: OpenStack project</p>
</li>
<li>
<p><strong>Domain</strong>: OpenStack domain name</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Choose one of the following options for validating CA certificates:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Use a custom CA certificate</strong>: Migrate after validating a custom CA certificate.</p>
</li>
<li>
<p><strong>Use the system CA certificate</strong>: Migrate after validating the system CA certificate.</p>
</li>
<li>
<p><strong>Skip certificate validation</strong> : Migrate without validating a CA certificate.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To use a custom CA certificate, leave the <strong>Skip certificate validation</strong> switch toggled to left, and <em>either</em> drag the CA certificate to the text box <em>or</em> browse for it and click <strong>Select</strong>.</p>
</li>
<li>
<p>To use the system CA certificate, leave the <strong>Skip certificate validation</strong> switch toggled to the left, and leave the <strong>CA certificate</strong> text box empty.</p>
</li>
<li>
<p>To skip certificate validation, toggle the <strong>Skip certificate validation</strong> switch to the right.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: Ask Forklift to fetch a custom CA certificate from the provider&#8217;s API endpoint URL.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Fetch certificate from URL</strong>. The <strong>Verify certificate</strong> window opens.</p>
</li>
<li>
<p>If the details are correct, select the <strong>I trust the authenticity of this certificate</strong> checkbox, and then, click <strong>Confirm</strong>. If not, click <strong>Cancel</strong>, and then, enter the correct certificate information manually.</p>
<div class="paragraph">
<p>Once confirmed, the CA certificate will be used to validate subsequent communication with the API endpoint.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Create provider</strong> to add and save the provider.</p>
<div class="paragraph">
<p>The provider appears in the list of providers.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="adding-source-provider_forklift">Adding an Open Virtual Appliance (OVA) source provider</h5>
<div class="paragraph">
<p>You can add Open Virtual Appliance (OVA) files that were created by VMware vSphere as a source provider by using the OKD web console.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Providers for virtualization</strong>.</p>
</li>
<li>
<p>Click <strong>Create Provider</strong>.</p>
</li>
<li>
<p>Click <strong>Open Virtual Appliance (OVA)</strong>.</p>
</li>
<li>
<p>Specify the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Provider resource name</strong>: Name of the source provider</p>
</li>
<li>
<p><strong>URL</strong>: URL of the NFS file share that serves the OVA</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Create provider</strong> to add and save the provider.</p>
<div class="paragraph">
<p>The provider appears in the list of providers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An error message might appear that states that an error has occurred. You can ignore this message.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="adding-source-provider_forklift">Adding a Red Hat KubeVirt source provider</h5>
<div class="paragraph">
<p>You can use a Red Hat KubeVirt provider as both a source provider and destination provider.</p>
</div>
<div class="paragraph">
<p>Specifically, the host cluster that is automatically added as a KubeVirt provider can be used as both a source provider and a destination provider.</p>
</div>
<div class="paragraph">
<p>You can migrate VMs from the cluster that Forklift is deployed on to another cluster, or from a remote cluster to the cluster that Forklift is deployed on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The OKD cluster version of the source provider must be 4.13 or later.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Providers for virtualization</strong>.</p>
</li>
<li>
<p>Click <strong>Create Provider</strong>.</p>
</li>
<li>
<p>Click <strong>KubeVirt</strong>.</p>
</li>
<li>
<p>Specify the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Provider resource name</strong>: Name of the source provider</p>
</li>
<li>
<p><strong>URL</strong>: URL of the endpoint of the API server</p>
</li>
<li>
<p><strong>Service account bearer token</strong>: Token for a service account with <code>cluster-admin</code> privileges</p>
<div class="paragraph">
<p>If both <strong>URL</strong> and <strong>Service account bearer token</strong> are left blank, the local OKD cluster is used.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Choose one of the following options for validating CA certificates:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Use a custom CA certificate</strong>: Migrate after validating a custom CA certificate.</p>
</li>
<li>
<p><strong>Use the system CA certificate</strong>: Migrate after validating the system CA certificate.</p>
</li>
<li>
<p><strong>Skip certificate validation</strong> : Migrate without validating a CA certificate.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To use a custom CA certificate, leave the <strong>Skip certificate validation</strong> switch toggled to left, and <em>either</em> drag the CA certificate to the text box <em>or</em> browse for it and click <strong>Select</strong>.</p>
</li>
<li>
<p>To use the system CA certificate, leave the <strong>Skip certificate validation</strong> switch toggled to the left, and leave the <strong>CA certificate</strong> text box empty.</p>
</li>
<li>
<p>To skip certificate validation, toggle the <strong>Skip certificate validation</strong> switch to the right.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: Ask Forklift to fetch a custom CA certificate from the provider&#8217;s API endpoint URL.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Fetch certificate from URL</strong>. The <strong>Verify certificate</strong> window opens.</p>
</li>
<li>
<p>If the details are correct, select the <strong>I trust the authenticity of this certificate</strong> checkbox, and then, click <strong>Confirm</strong>. If not, click <strong>Cancel</strong>, and then, enter the correct certificate information manually.</p>
<div class="paragraph">
<p>Once confirmed, the CA certificate will be used to validate subsequent communication with the API endpoint.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Create provider</strong> to add and save the provider.</p>
<div class="paragraph">
<p>The provider appears in the list of providers.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding-destination-providers">Adding destination providers</h4>
<div class="paragraph">
<p>You can add a KubeVirt destination provider by using the OKD web console.</p>
</div>
<div class="sect4">
<h5 id="adding-source-provider_forklift">Adding a KubeVirt destination provider</h5>
<div class="paragraph">
<p>You can use a Red Hat KubeVirt provider as both a source provider and destination provider.</p>
</div>
<div class="paragraph">
<p>Specifically, the host cluster that is automatically added as a KubeVirt provider can be used as both a source provider and a destination provider.</p>
</div>
<div class="paragraph">
<p>You can also add another KubeVirt destination provider to the OKD web console in addition to the default KubeVirt destination provider, which is the cluster where you installed Forklift.</p>
</div>
<div class="paragraph">
<p>You can migrate VMs from the cluster that Forklift is deployed on to another cluster, or from a remote cluster to the cluster that Forklift is deployed on.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have a KubeVirt <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.10/html/authentication_and_authorization/using-service-accounts">service account token</a> with <code>cluster-admin</code> privileges.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Providers for virtualization</strong>.</p>
</li>
<li>
<p>Click <strong>Create Provider</strong>.</p>
</li>
<li>
<p>Click <strong>KubeVirt</strong>.</p>
</li>
<li>
<p>Specify the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Provider resource name</strong>: Name of the source provider</p>
</li>
<li>
<p><strong>URL</strong>: URL of the endpoint of the API server</p>
</li>
<li>
<p><strong>Service account bearer token</strong>: Token for a service account with <code>cluster-admin</code> privileges</p>
<div class="paragraph">
<p>If both <strong>URL</strong> and <strong>Service account bearer token</strong> are left blank, the local OKD cluster is used.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Choose one of the following options for validating CA certificates:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Use a custom CA certificate</strong>: Migrate after validating a custom CA certificate.</p>
</li>
<li>
<p><strong>Use the system CA certificate</strong>: Migrate after validating the system CA certificate.</p>
</li>
<li>
<p><strong>Skip certificate validation</strong> : Migrate without validating a CA certificate.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>To use a custom CA certificate, leave the <strong>Skip certificate validation</strong> switch toggled to left, and <em>either</em> drag the CA certificate to the text box <em>or</em> browse for it and click <strong>Select</strong>.</p>
</li>
<li>
<p>To use the system CA certificate, leave the <strong>Skip certificate validation</strong> switch toggled to the left, and leave the <strong>CA certificate</strong> text box empty.</p>
</li>
<li>
<p>To skip certificate validation, toggle the <strong>Skip certificate validation</strong> switch to the right.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional: Ask Forklift to fetch a custom CA certificate from the provider&#8217;s API endpoint URL.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Fetch certificate from URL</strong>. The <strong>Verify certificate</strong> window opens.</p>
</li>
<li>
<p>If the details are correct, select the <strong>I trust the authenticity of this certificate</strong> checkbox, and then, click <strong>Confirm</strong>. If not, click <strong>Cancel</strong>, and then, enter the correct certificate information manually.</p>
<div class="paragraph">
<p>Once confirmed, the CA certificate will be used to validate subsequent communication with the API endpoint.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Create provider</strong> to add and save the provider.</p>
<div class="paragraph">
<p>The provider appears in the list of providers.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="selecting-migration-network-for-virt-provider_forklift">Selecting a migration network for a KubeVirt provider</h5>
<div class="paragraph">
<p>You can select a default migration network for a KubeVirt provider in the OKD web console to improve performance. The default migration network is used to transfer disks to the namespaces in which it is configured.</p>
</div>
<div class="paragraph">
<p>If you do not select a migration network, the default migration network is the <code>pod</code> network, which might not be optimal for disk transfer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can override the default migration network of the provider by selecting a different network when you create a migration plan.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Providers for virtualization</strong>.</p>
</li>
<li>
<p>On the right side of the provider, select <strong>Select migration network</strong> from the Options menu <span class="image"><img src="../modules/images/kebab.png" alt="kebab" height="20" title="Options menu"></span>.</p>
</li>
<li>
<p>Select a network from the list of available networks and click <strong>Select</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="creating-migration-plans-ui">Creating migration plans</h3>
<div class="paragraph">
<p>You can create a migration plan by using the OKD web console to specify a source provider, the virtual machines (VMs) you want to migrate, and other plan details.</p>
</div>
<div class="paragraph">
<p>For your convenience, there are two procedures to create migration plans based on source provider and VMs, one begins on the  <a href="#creating-migration-quick-plan-vm_forklift"><strong>Providers for virtualization</strong> page</a> and the other begins on the <a href="#creating-migration-quick-plan-existing-source_forklift"><strong>Plans for virtualization</strong> page</a>.</p>
</div>
<div class="sect3">
<h4 id="creating-migration-quick-plan-vm_forklift">Creating and running a migration plan starting on Providers for virtualization</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Providers for virtualization</strong>.</p>
</li>
<li>
<p>In the row of the appropriate source provider, click <strong>VMs</strong>.
+.
The <strong>Virtual Machines</strong> tab opens.</p>
</li>
<li>
<p>Select the VMs you want to migrate and click <strong>Create migration plan</strong>.</p>
<div class="paragraph">
<p>The <strong>Create migration plan</strong> pane opens. It displays the source provider&#8217;s name and suggestions for a target provider and namespace, a network map, and a storage map.</p>
</div>
</li>
<li>
<p>Enter the <strong>Plan name</strong>.</p>
</li>
<li>
<p>Make any desired changes to the editable items.</p>
</li>
<li>
<p>Click <strong>Add mapping</strong> to edit a suggested network mapping or a storage mapping, or to add one or more additional mappings.</p>
</li>
<li>
<p>Click <strong>Create migration plan</strong>.</p>
<div class="paragraph">
<p>Forklift validates the migration plan and the <strong>Plan details</strong> page opens, indicating whether the plan is ready for use or contains an error. In all cases, the details of the plan are listed, and you can edit the items you filled in on the previous page. If you make any changes, Forklift again validates the plan.</p>
</div>
</li>
<li>
<p>If the plan is valid,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>You can run the plan now by clicking <strong>Start migration</strong>.</p>
</li>
<li>
<p>You can run the plan later by selecting it on the <strong>Plans for virtualization</strong> page and following the procedure in <a href="#running-migration-plan_forklift">Running a migration plan</a>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="creating-migration-quick-plan-existing-source_forklift">Creating and running a migration plan starting on Plans for virtualization</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Plans for virtualization</strong> and then click <strong>Create Plan</strong>.</p>
<div class="paragraph">
<p>The  <strong>Create migration plan</strong> wizard opens to the <strong>Select source provider</strong> interface.</p>
</div>
</li>
<li>
<p>Select the source provider of the VMs you want to migrate.</p>
<div class="paragraph">
<p>The <strong>Select virtual machines</strong> interface opens.</p>
</div>
</li>
<li>
<p>Select the VMs you want to migrate and click <strong>Next</strong>.</p>
<div class="paragraph">
<p>The <strong>Create migration plan</strong> pane opens. It displays the source provider&#8217;s name and suggestions for a target provider and namespace, a network map, and a storage map.</p>
</div>
</li>
<li>
<p>Enter the <strong>Plan name</strong>.</p>
</li>
<li>
<p>Make any desired changes to the editable items.</p>
</li>
<li>
<p>Click <strong>Add mapping</strong> to edit a suggested network mapping or a storage mapping, or to add one or more additional mappings.</p>
</li>
<li>
<p>Click <strong>Create migration plan</strong>.</p>
<div class="paragraph">
<p>Forklift validates the migration plan and the <strong>Plan details</strong> page opens, indicating whether the plan is ready for use or contains an error. In all cases, the details of the plan are listed, and you can edit the items you filled in on the previous page. If you make any changes, Forklift again validates the plan.</p>
</div>
</li>
<li>
<p>If the plan is valid,</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>You can run the plan now by clicking <strong>Start migration</strong>.</p>
</li>
<li>
<p>You can run the plan later by selecting it on the <strong>Plans for virtualization</strong> page and following the procedure in <a href="#running-migration-plan_forklift">Running a migration plan</a>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="running-migration-plan_forklift">Running a migration plan</h3>
<div class="paragraph">
<p>You can run a migration plan and view its progress in the OKD web console.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Valid migration plan.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Plans for virtualization</strong>.</p>
<div class="paragraph">
<p>The <strong>Plans</strong> list displays the source and target providers, the number of virtual machines (VMs) being migrated, the status, and the description of each plan.</p>
</div>
</li>
<li>
<p>Click <strong>Start</strong> beside a migration plan to start the migration.</p>
</li>
<li>
<p>Click <strong>Start</strong> in the confirmation window that opens.</p>
<div class="paragraph">
<p>The <strong>Migration details by VM</strong> screen opens, displaying the migration&#8217;s progress</p>
</div>
<div class="paragraph">
<p>Warm migration only:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The precopy stage starts.</p>
</li>
<li>
<p>Click <strong>Cutover</strong> to complete the migration.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the migration fails:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Get logs</strong> to retrieve the migration logs.</p>
</li>
<li>
<p>Click <strong>Get logs</strong> in the confirmation window that opens.</p>
</li>
<li>
<p>Wait until <strong>Get logs</strong>  changes to <strong>Download logs</strong> and then click the button to download the logs.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click a migration&#8217;s <strong>Status</strong>, whether it failed or succeeded or is still ongoing, to view the details of the migration.</p>
<div class="paragraph">
<p>The <strong>Migration details by VM</strong> screen opens, displaying the start and end times of the migration, the amount of data copied, and a progress pipeline for each VM being migrated.</p>
</div>
</li>
<li>
<p>Expand an individual VM to view its steps and the elapsed time and state of each step.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="migration-plan-options-ui_forklift">Migration plan options</h3>
<div class="paragraph">
<p>On the <strong>Plans for virtualization</strong> page of the OKD web console, you can click the Options menu <span class="image"><img src="../modules/images/kebab.png" alt="kebab" height="20" title="Options menu"></span> beside a migration plan to access the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Get logs</strong>: Retrieves the logs of a migration. When you click <strong>Get logs</strong>, a confirmation window opens. After you click <strong>Get logs</strong> in the window, wait until <strong>Get logs</strong> changes to <strong>Download logs</strong> and then click the button to download the logs.</p>
</li>
<li>
<p><strong>Edit</strong>: Edit the details of a migration plan. You cannot edit a migration plan while it is running or after it has completed successfully.</p>
</li>
<li>
<p><strong>Duplicate</strong>: Create a new migration plan with the same virtual machines (VMs), parameters, mappings, and hooks as an existing plan. You can use this feature for the following tasks:</p>
<div class="ulist">
<ul>
<li>
<p>Migrate VMs to a different namespace.</p>
</li>
<li>
<p>Edit an archived migration plan.</p>
</li>
<li>
<p>Edit a migration plan with a different status, for example, failed, canceled, running, critical, or ready.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Archive</strong>: Delete the logs, history, and metadata of a migration plan. The plan cannot be edited or restarted. It can only be viewed.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>Archive</strong> option is irreversible. However, you can duplicate an archived plan.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Delete</strong>: Permanently remove a migration plan. You cannot delete a running migration plan.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>Delete</strong> option is irreversible.</p>
</div>
<div class="paragraph">
<p>Deleting a migration plan does not remove temporary resources such as <code>importer</code> pods, <code>conversion</code> pods, config maps, secrets, failed VMs, and data volumes. (<a href="https://bugzilla.redhat.com/show_bug.cgi?id=2018974"><strong>BZ#2018974</strong></a>) You must archive a migration plan before deleting it in order to clean up the temporary resources.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>View details</strong>: Display the details of a migration plan.</p>
</li>
<li>
<p><strong>Restart</strong>: Restart a failed or canceled migration plan.</p>
</li>
<li>
<p><strong>Cancel scheduled cutover</strong>: Cancel a scheduled cutover migration for a warm migration plan.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="canceling-migration-ui_forklift">Canceling a migration</h3>
<div class="paragraph">
<p>You can cancel the migration of some or all virtual machines (VMs) while a migration plan is in progress by using the OKD web console.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Plans for virtualization</strong>.</p>
</li>
<li>
<p>Click the name of a running migration plan to view the migration details.</p>
</li>
<li>
<p>Select one or more VMs and click <strong>Cancel</strong>.</p>
</li>
<li>
<p>Click <strong>Yes, cancel</strong> to confirm the cancellation.</p>
<div class="paragraph">
<p>In the <strong>Migration details by VM</strong> list, the status of the canceled VMs is <strong>Canceled</strong>. The unmigrated and the migrated virtual machines are not affected.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can restart a canceled migration by clicking <strong>Restart</strong> beside the migration plan on the <strong>Migration plans</strong> page.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migrating-virtual-machines-from-the-command-line_forklift">Migrating virtual machines from the command line</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can migrate virtual machines to KubeVirt from the command line.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must ensure that all <a href="#prerequisites_forklift">prerequisites</a> are met.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="non-admin-permissions_forklift">Permissions needed by non-administrators to work with migration plan components</h3>
<div class="paragraph">
<p>If you are an administrator, you can work with all components of migration plans (for example, providers, network mappings, and migration plans).</p>
</div>
<div class="paragraph">
<p>By default, non-administrators have limited ability to work with migration plans and their components. As an administrator, you can modify their roles to allow them full access to all components, or you can give them limited permissions.</p>
</div>
<div class="paragraph">
<p>For example, administrators can assign non-administrators one or more of the following cluster roles for migration plans:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Example migration plan roles and their privileges</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plans.forklift.konveyor.io-v1beta1-view</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can view migration plans but not to create, delete or modify them</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plans.forklift.konveyor.io-v1beta1-edit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, delete or modify (all parts of <code>edit</code> permissions) individual migration plans</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plans.forklift.konveyor.io-v1beta1-admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All <code>edit</code> privileges and the ability to delete the entire collection of migration plans</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that pre-defined cluster roles include a resource (for example, <code>plans</code>), an API group (for example, <code>forklift.konveyor.io-v1beta1</code>) and an action (for example, <code>view</code>, <code>edit</code>).</p>
</div>
<div class="paragraph">
<p>As a more comprehensive example, you can grant non-administrators the following set of permissions per namespace:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create and modify storage maps, network maps, and migration plans for the namespaces they have access to</p>
</li>
<li>
<p>Attach providers created by administrators to storage maps, network maps, and migration plans</p>
</li>
<li>
<p>Not be able to create providers or to change system settings</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Example permissions required for non-adminstrators to work with migration plan components but not create providers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Actions</th>
<th class="tableblock halign-left valign-top">API group</th>
<th class="tableblock halign-left valign-top">Resource</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>list</code>, <code>watch</code>, <code>create</code>, <code>update</code>, <code>patch</code>, <code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forklift.konveyor.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>plans</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>list</code>, <code>watch</code>, <code>create</code>, <code>update</code>, <code>patch</code>, <code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forklift.konveyor.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>migrations</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>list</code>, <code>watch</code>, <code>create</code>, <code>update</code>, <code>patch</code>, <code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forklift.konveyor.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>hooks</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>list</code>, <code>watch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forklift.konveyor.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>providers</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>list</code>, <code>watch</code>, <code>create</code>, <code>update</code>, <code>patch</code>, <code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forklift.konveyor.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>networkmaps</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>list</code>, <code>watch</code>, <code>create</code>, <code>update</code>, <code>patch</code>, <code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forklift.konveyor.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>storagemaps</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>get</code>, <code>list</code>, <code>watch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forklift.konveyor.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forkliftcontrollers</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create</code>, <code>patch</code>, <code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secrets</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Non-administrators need to have the <code>create</code> permissions that are part of <code>edit</code> roles for network maps and for storage maps to create migration plans, even when using a template for a network map or a storage map.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="migrating-virtual-machines_forklift">Migrating virtual machines</h3>
<div class="paragraph">
<p>You migrate virtual machines (VMs) from the command line (CLI) by creating Forklift custom resources (CRs). The CRs and the migration procedure vary by source provider.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must specify a name for cluster-scoped CRs.</p>
</div>
<div class="paragraph">
<p>You must specify both a name and a namespace for namespace-scoped CRs.</p>
</div>
<div class="paragraph">
<p>In order to migrate to or from an OKD cluster that is different than the one the migration plan is defined on, you must have an KubeVirt service account token with <code>cluster-admin</code> privileges.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="new-migrating-virtual-machines-cli_forklift">Migrating from a VMware vSphere source provider</h4>
<div class="paragraph">
<p>You can migrate from a VMware vSphere source provider using the CLI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Secret</code> manifest for the source provider credentials:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences: <i class="conum" data-value="1"></i><b>(1)</b>
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: vsphere
    createdForResourceType: providers
type: Opaque
stringData:
  user: &lt;user&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  password: &lt;password&gt; <i class="conum" data-value="3"></i><b>(3)</b>
  insecureSkipVerify: &lt;"true"/"false"&gt; <i class="conum" data-value="4"></i><b>(4)</b>
  cacert: | <i class="conum" data-value="5"></i><b>(5)</b>
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt; <i class="conum" data-value="6"></i><b>(6)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ownerReferences</code> section is optional.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the vCenter user or the ESX/ESXi user.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the password of the vCenter user or the ESX/ESXi user.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify <code>"true"</code> to skip certificate verification, specify <code>"false"</code> to verify the certificate. Defaults to <code>"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>When this field is not set and <em>skip certificate verification</em> is disabled, Forklift attempts to use the system CA.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify the API endpoint URL of the vCenter or the ESX/ESX, for example, <code>https://&lt;vCenter_host&gt;/sdk</code>.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create a <code>Provider</code> manifest for the source provider:</p>
<div class="paragraph">
<p>+</p>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ cat &lt;&lt; EOF | {oc} apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: vsphere
  url: &lt;api_end_point&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  settings:
    vddkInitImage: &lt;VDDK_image&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    sdkEndpoint: vcenter <i class="conum" data-value="3"></i><b>(3)</b>
  secret:
    name: &lt;secret&gt; <i class="conum" data-value="4"></i><b>(4)</b>
    namespace: &lt;namespace&gt;
EOF</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the URL of the API endpoint, for example, <code>https://&lt;vCenter_host&gt;/sdk</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optional, but it is strongly recommended to create a VDDK image to accelerate migrations. Follow OpenShift documentation to specify the VDDK image you created.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Options: <code>vcenter</code> or <code>esxi</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify the name of the provider <code>Secret</code> CR.</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Create a <code>Host</code> manifest:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Host
metadata:
  name: &lt;vmware_host&gt;
  namespace: &lt;namespace&gt;
spec:
  provider:
    namespace: &lt;namespace&gt;
    name: &lt;source_provider&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  id: &lt;source_host_mor&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  ipAddress: &lt;source_network_ip&gt; <i class="conum" data-value="3"></i><b>(3)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the name of the VMware vSphere <code>Provider</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the Managed Object Reference (MoRef) of the VMware vSphere host.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the IP address of the VMware vSphere migration network.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Create a <code>NetworkMap</code> manifest to map the source and destination networks:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod <i class="conum" data-value="1"></i><b>(1)</b>
      source: <i class="conum" data-value="2"></i><b>(2)</b>
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
    - destination:
        name: &lt;network_attachment_definition&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        namespace: &lt;network_attachment_definition_namespace&gt; <i class="conum" data-value="4"></i><b>(4)</b>
        type: multus
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>pod</code> and <code>multus</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use either the <code>id</code> <em>or</em> the <code>name</code> parameter to specify the source network. For <code>id</code>, specify the VMware vSphere network Managed Object Reference (MoRef).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a network attachment definition for each additional KubeVirt network.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Required only when <code>type</code> is <code>multus</code>. Specify the namespace of the KubeVirt network attachment definition.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="5">
<li>
<p>Create a <code>StorageMap</code> manifest to map source and destination storage:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <i class="conum" data-value="1"></i><b>(1)</b>
      source:
        id: &lt;source_datastore&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>ReadWriteOnce</code> and <code>ReadWriteMany</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the VMware vSphere data storage MoRef. For example, <code>f2737930-b567-451a-9ceb-2887f6207009</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optional: Create a <code>Hook</code> manifest to run custom code on a VM during the phase specified in the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/konveyor/hook-runner
  playbook: |
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="paragraph">
<p><code>playbook</code> refers to an optional Base64-encoded Ansible playbook. If you specify a playbook, the <code>image</code> must be <code>hook-runner</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the default <code>hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="7">
<li>
<p>Create a <code>Plan</code> manifest for the migration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  namespace: &lt;namespace&gt;
spec:
  warm: false <i class="conum" data-value="2"></i><b>(2)</b>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map: <i class="conum" data-value="3"></i><b>(3)</b>
    network: <i class="conum" data-value="4"></i><b>(4)</b>
      name: &lt;network_map&gt; <i class="conum" data-value="5"></i><b>(5)</b>
      namespace: &lt;namespace&gt;
    storage: <i class="conum" data-value="6"></i><b>(6)</b>
      name: &lt;storage_map&gt; <i class="conum" data-value="7"></i><b>(7)</b>
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms: <i class="conum" data-value="8"></i><b>(8)</b>
    - id: &lt;source_vm&gt; <i class="conum" data-value="9"></i><b>(9)</b>
    - name: &lt;source_vm&gt;
      hooks: <i class="conum" data-value="10"></i><b>(10)</b>
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt; <i class="conum" data-value="11"></i><b>(11)</b>
          step: &lt;step&gt; <i class="conum" data-value="12"></i><b>(12)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the name of the <code>Plan</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify whether the migration is warm - <code>true</code> - or cold - <code>false</code>. If you specify a warm migration without specifying a value for the <code>cutover</code> parameter in the <code>Migration</code> manifest, only the precopy stage will run.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify only one network map and one storage map per plan.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify a network mapping even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify the name of the <code>NetworkMap</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify a storage mapping even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Specify the name of the <code>StorageMap</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>You can use either the <code>id</code> <em>or</em> the <code>name</code> parameter to specify the source VMs.<br></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Specify the VMware vSphere VM MoRef.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Specify the name of the <code>Hook</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Allowed values are <code>PreHook</code>, before the migration plan starts, or <code>PostHook</code>, after the migration is complete.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a <code>Migration</code> manifest to run the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code>2024-04-04T01:23:45.678+09:00</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="new-migrating-virtual-machines-cli_forklift">Migrating from a oVirt source provider</h4>
<div class="paragraph">
<p>You can migrate from a oVirt (oVirt) source provider using the CLI.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>If you are migrating a virtual machine with a direct LUN disk, ensure that the nodes in the KubeVirt destination cluster that the VM is expected to run on can access the backend storage.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Unlike disk images that <em>are copied</em> from a source provider to a target provider, LUNs are <em>detached</em>, <em>but not removed</em>, from virtual machines in the source provider and then attached to the virtual machines (VMs) that are created in the target provider.</p>
</li>
<li>
<p>LUNs are not removed from the source provider during the migration in case fallback to the source provider is required. However, before re-attaching the LUNs to VMs in the source provider, ensure that the LUNs are not used by VMs on the target environment at the same time, which might lead to data corruption.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Secret</code> manifest for the source provider credentials:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences: <i class="conum" data-value="1"></i><b>(1)</b>
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: ovirt
    createdForResourceType: providers
type: Opaque
stringData:
  user: &lt;user&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  password: &lt;password&gt; <i class="conum" data-value="3"></i><b>(3)</b>
  insecureSkipVerify: &lt;"true"/"false"&gt; <i class="conum" data-value="4"></i><b>(4)</b>
  cacert: | <i class="conum" data-value="5"></i><b>(5)</b>
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt; <i class="conum" data-value="6"></i><b>(6)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ownerReferences</code> section is optional.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the oVirt Engine user.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the user password.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify <code>"true"</code> to skip certificate verification, specify <code>"false"</code> to verify the certificate. Defaults to <code>"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Enter the Engine CA certificate, unless it was replaced by a third-party certificate, in which case, enter the Engine Apache CA certificate. You can retrieve the Engine CA certificate at <a href="https://&lt;engine_host&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA" class="bare">https://&lt;engine_host&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify the API endpoint URL, for example, <code>https://&lt;engine_host&gt;/ovirt-engine/api</code>.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create a <code>Provider</code> manifest for the source provider:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: ovirt
  url: &lt;api_end_point&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  secret:
    name: &lt;secret&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the URL of the API endpoint, for example, <code>https://&lt;engine_host&gt;/ovirt-engine/api</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the name of provider <code>Secret</code> CR.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Create a <code>NetworkMap</code> manifest to map the source and destination networks:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod <i class="conum" data-value="1"></i><b>(1)</b>
      source: <i class="conum" data-value="2"></i><b>(2)</b>
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
    - destination:
        name: &lt;network_attachment_definition&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        namespace: &lt;network_attachment_definition_namespace&gt; <i class="conum" data-value="4"></i><b>(4)</b>
        type: multus
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>pod</code> and <code>multus</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use either the <code>id</code> <em>or</em> the <code>name</code> parameter to specify the source network. For <code>id</code>, specify the oVirt network Universal Unique ID (UUID).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a network attachment definition for each additional KubeVirt network.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Required only when <code>type</code> is <code>multus</code>. Specify the namespace of the KubeVirt network attachment definition.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Create a <code>StorageMap</code> manifest to map source and destination storage:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <i class="conum" data-value="1"></i><b>(1)</b>
      source:
        id: &lt;source_storage_domain&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>ReadWriteOnce</code> and <code>ReadWriteMany</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the oVirt storage domain UUID. For example, <code>f2737930-b567-451a-9ceb-2887f6207009</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optional: Create a <code>Hook</code> manifest to run custom code on a VM during the phase specified in the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/konveyor/hook-runner
  playbook: |
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="paragraph">
<p><code>playbook</code> refers to an optional Base64-encoded Ansible playbook. If you specify a playbook, the <code>image</code> must be <code>hook-runner</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the default <code>hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Create a <code>Plan</code> manifest for the migration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  namespace: &lt;namespace&gt;
  preserveClusterCpuModel: true <i class="conum" data-value="2"></i><b>(2)</b>
spec:
  warm: false <i class="conum" data-value="3"></i><b>(3)</b>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map: <i class="conum" data-value="4"></i><b>(4)</b>
    network: <i class="conum" data-value="5"></i><b>(5)</b>
      name: &lt;network_map&gt; <i class="conum" data-value="6"></i><b>(6)</b>
      namespace: &lt;namespace&gt;
    storage: <i class="conum" data-value="7"></i><b>(7)</b>
      name: &lt;storage_map&gt; <i class="conum" data-value="8"></i><b>(8)</b>
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms: <i class="conum" data-value="9"></i><b>(9)</b>
    - id: &lt;source_vm&gt; <i class="conum" data-value="10"></i><b>(10)</b>
    - name: &lt;source_vm&gt;
      hooks: <i class="conum" data-value="11"></i><b>(11)</b>
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt; <i class="conum" data-value="12"></i><b>(12)</b>
          step: &lt;step&gt; <i class="conum" data-value="13"></i><b>(13)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the name of the <code>Plan</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>See note below.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify whether the migration is warm or cold. If you specify a warm migration without specifying a value for the <code>cutover</code> parameter in the <code>Migration</code> manifest, only the precopy stage will run.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify only one network map and one storage map per plan.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify a network mapping even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify the name of the <code>NetworkMap</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Specify a storage mapping even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Specify the name of the <code>StorageMap</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>You can use either the <code>id</code> <em>or</em> the <code>name</code> parameter to specify the source VMs.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Specify the oVirt VM UUID.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>Specify the name of the <code>Hook</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>Allowed values are <code>PreHook</code>, before the migration plan starts, or <code>PostHook</code>, after the migration is complete.
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>If the migrated machines is set with a custom CPU model, it will be set with that CPU model in the destination cluster, regardless of the setting of <code>preserveClusterCpuModel</code>.</p>
</li>
<li>
<p>If the migrated machine is <em>not</em> set with a custom CPU model:</p>
<div class="ulist">
<ul>
<li>
<p>If <code>preserveClusterCpuModel</code> is set to 'true`, Forklift checks the CPU model of the VM when it runs in oVirt, based on the cluster&#8217;s configuration, and then sets the migrated VM with that CPU model.</p>
</li>
<li>
<p>If <code>preserveClusterCpuModel</code> is set to 'false`, Forklift does not set a CPU type and the VM is set with the default CPU model of the destination cluster.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a <code>Migration</code> manifest to run the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code>2024-04-04T01:23:45.678+09:00</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="new-migrating-virtual-machines-cli_forklift">Migrating from an OpenStack source provider</h4>
<div class="paragraph">
<p>You can migrate from an OpenStack source provider using the CLI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Secret</code> manifest for the source provider credentials:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences: <i class="conum" data-value="1"></i><b>(1)</b>
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: openstack
    createdForResourceType: providers
type: Opaque
stringData:
  user: &lt;user&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  password: &lt;password&gt; <i class="conum" data-value="3"></i><b>(3)</b>
  insecureSkipVerify: &lt;"true"/"false"&gt; <i class="conum" data-value="4"></i><b>(4)</b>
  domainName: &lt;domain_name&gt;
  projectName: &lt;project_name&gt;
  regionName: &lt;region_name&gt;
  cacert: | <i class="conum" data-value="5"></i><b>(5)</b>
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt; <i class="conum" data-value="6"></i><b>(6)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ownerReferences</code> section is optional.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the OpenStack user.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the user OpenStack password.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify <code>"true"</code> to skip certificate verification, specify <code>"false"</code> to verify the certificate. Defaults to <code>"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>When this field is not set and <em>skip certificate verification</em> is disabled, Forklift attempts to use the system CA.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify the API endpoint URL, for example, <code>https://&lt;identity_service&gt;/v3</code>.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create a <code>Provider</code> manifest for the source provider:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: openstack
  url: &lt;api_end_point&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  secret:
    name: &lt;secret&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the URL of the API endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the name of provider <code>Secret</code> CR.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Create a <code>NetworkMap</code> manifest to map the source and destination networks:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod <i class="conum" data-value="1"></i><b>(1)</b>
      source:<i class="conum" data-value="2"></i><b>(2)</b>
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
    - destination:
        name: &lt;network_attachment_definition&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        namespace: &lt;network_attachment_definition_namespace&gt; <i class="conum" data-value="4"></i><b>(4)</b>
        type: multus
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>pod</code> and <code>multus</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can use either the <code>id</code> <em>or</em> the <code>name</code> parameter to specify the source network. For <code>id</code>, specify the OpenStack network UUID.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a network attachment definition for each additional KubeVirt network.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Required only when <code>type</code> is <code>multus</code>. Specify the namespace of the KubeVirt network attachment definition.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Create a <code>StorageMap</code> manifest to map source and destination storage:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <i class="conum" data-value="1"></i><b>(1)</b>
      source:
        id: &lt;source_volume_type&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>ReadWriteOnce</code> and <code>ReadWriteMany</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the OpenStack <code>volume_type</code> UUID. For example, <code>f2737930-b567-451a-9ceb-2887f6207009</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optional: Create a <code>Hook</code> manifest to run custom code on a VM during the phase specified in the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/konveyor/hook-runner
  playbook: |
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="paragraph">
<p><code>playbook</code> refers to an optional Base64-encoded Ansible playbook. If you specify a playbook, the <code>image</code> must be <code>hook-runner</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the default <code>hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Create a <code>Plan</code> manifest for the migration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  namespace: &lt;namespace&gt;
spec:
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map: <i class="conum" data-value="2"></i><b>(2)</b>
    network: <i class="conum" data-value="3"></i><b>(3)</b>
      name: &lt;network_map&gt; <i class="conum" data-value="4"></i><b>(4)</b>
      namespace: &lt;namespace&gt;
    storage: <i class="conum" data-value="5"></i><b>(5)</b>
      name: &lt;storage_map&gt; <i class="conum" data-value="6"></i><b>(6)</b>
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms: <i class="conum" data-value="7"></i><b>(7)</b>
    - id: &lt;source_vm&gt; <i class="conum" data-value="8"></i><b>(8)</b>
    - name: &lt;source_vm&gt;
      hooks: <i class="conum" data-value="9"></i><b>(9)</b>
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt; <i class="conum" data-value="10"></i><b>(10)</b>
          step: &lt;step&gt; <i class="conum" data-value="11"></i><b>(11)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the name of the <code>Plan</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify only one network map and one storage map per plan.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a network mapping, even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify the name of the <code>NetworkMap</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify a storage mapping, even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify the name of the <code>StorageMap</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can use either the <code>id</code> <em>or</em> the <code>name</code> parameter to specify the source VMs.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Specify the OpenStack VM UUID.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Specify the name of the <code>Hook</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Allowed values are <code>PreHook</code>, before the migration plan starts, or <code>PostHook</code>, after the migration is complete.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a <code>Migration</code> manifest to run the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code>2024-04-04T01:23:45.678+09:00</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="new-migrating-virtual-machines-cli_forklift">Migrating from an Open Virtual Appliance (OVA) source provider</h4>
<div class="paragraph">
<p>You can migrate from Open Virtual Appliance (OVA) files that were created by VMware vSphere as a source provider using the CLI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Secret</code> manifest for the source provider credentials:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences: <i class="conum" data-value="1"></i><b>(1)</b>
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: ova
    createdForResourceType: providers
type: Opaque
stringData:
  url: &lt;nfs_server:/nfs_path&gt; <i class="conum" data-value="2"></i><b>(2)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ownerReferences</code> section is optional.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>where: <code>nfs_server</code> is an IP or hostname of the server where the share was created and <code>nfs_path</code> is the path on the server where the OVA files are stored.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create a <code>Provider</code> manifest for the source provider:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: ova
  url:  &lt;nfs_server:/nfs_path&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  secret:
    name: &lt;secret&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>where: <code>nfs_server</code> is an IP or hostname of the server where the share was created and <code>nfs_path</code> is the path on the server where the OVA files are stored.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the name of provider <code>Secret</code> CR.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Create a <code>NetworkMap</code> manifest to map the source and destination networks:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod <i class="conum" data-value="1"></i><b>(1)</b>
      source:
        id: &lt;source_network_id&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    - destination:
        name: &lt;network_attachment_definition&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        namespace: &lt;network_attachment_definition_namespace&gt; <i class="conum" data-value="4"></i><b>(4)</b>
        type: multus
      source:
        id: &lt;source_network_id&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>pod</code> and <code>multus</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the OVA network Universal Unique ID (UUID).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a network attachment definition for each additional KubeVirt network.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Required only when <code>type</code> is <code>multus</code>. Specify the namespace of the KubeVirt network attachment definition.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Create a <code>StorageMap</code> manifest to map source and destination storage:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <i class="conum" data-value="1"></i><b>(1)</b>
      source:
        name:  Dummy storage for source provider &lt;provider_name&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>ReadWriteOnce</code> and <code>ReadWriteMany</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>For OVA, the <code>StorageMap</code> can map only a single storage, which all the disks from the OVA are associated with, to a storage class at the destination. For this reason, the storage is referred to in the UI as "Dummy storage for source provider &lt;provider_name&gt;". In the YAML, write the phrase as it appears above, without the quotation marks and replacing &lt;provider_name&gt; with the actual name of the provider.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optional: Create a <code>Hook</code> manifest to run custom code on a VM during the phase specified in the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/konveyor/hook-runner
  playbook: |
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="paragraph">
<p><code>playbook</code> refers to an optional Base64-encoded Ansible playbook. If you specify a playbook, the <code>image</code> must be <code>hook-runner</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the default <code>hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Create a <code>Plan</code> manifest for the migration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  namespace: &lt;namespace&gt;
spec:
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map: <i class="conum" data-value="2"></i><b>(2)</b>
    network: <i class="conum" data-value="3"></i><b>(3)</b>
      name: &lt;network_map&gt; <i class="conum" data-value="4"></i><b>(4)</b>
      namespace: &lt;namespace&gt;
    storage: <i class="conum" data-value="5"></i><b>(5)</b>
      name: &lt;storage_map&gt; <i class="conum" data-value="6"></i><b>(6)</b>
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms: <i class="conum" data-value="7"></i><b>(7)</b>
    - id: &lt;source_vm&gt; <i class="conum" data-value="8"></i><b>(8)</b>
    - name: &lt;source_vm&gt;
      hooks: <i class="conum" data-value="9"></i><b>(9)</b>
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt; <i class="conum" data-value="10"></i><b>(10)</b>
          step: &lt;step&gt; <i class="conum" data-value="11"></i><b>(11)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the name of the <code>Plan</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify only one network map and one storage map per plan.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a network mapping, even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify the name of the <code>NetworkMap</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify a storage mapping even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify the name of the <code>StorageMap</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>You can use either the <code>id</code> <em>or</em> the <code>name</code> parameter to specify the source VMs.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Specify the OVA VM UUID.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Specify the name of the <code>Hook</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Allowed values are <code>PreHook</code>, before the migration plan starts, or <code>PostHook</code>, after the migration is complete.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a <code>Migration</code> manifest to run the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code>2024-04-04T01:23:45.678+09:00</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="new-migrating-virtual-machines-cli_forklift">Migrating from a Red Hat KubeVirt source provider</h4>
<div class="paragraph">
<p>You can use a Red Hat KubeVirt provider as a source provider as well as a destination provider.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Secret</code> manifest for the source provider credentials:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: &lt;namespace&gt;
  ownerReferences: <i class="conum" data-value="1"></i><b>(1)</b>
    - apiVersion: forklift.konveyor.io/v1beta1
      kind: Provider
      name: &lt;provider_name&gt;
      uid: &lt;provider_uid&gt;
  labels:
    createdForProviderType: openshift
    createdForResourceType: providers
type: Opaque
stringData:
  token: &lt;token&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  password: &lt;password&gt; <i class="conum" data-value="3"></i><b>(3)</b>
  insecureSkipVerify: &lt;"true"/"false"&gt; <i class="conum" data-value="4"></i><b>(4)</b>
  cacert: | <i class="conum" data-value="5"></i><b>(5)</b>
    &lt;ca_certificate&gt;
  url: &lt;api_end_point&gt; <i class="conum" data-value="6"></i><b>(6)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>ownerReferences</code> section is optional.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify a token for a service account with <code>cluster-admin</code> privileges. If both <code>token</code> and <code>url</code> are left blank, the local OKD cluster is used.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the user password.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify <code>"true"</code> to skip certificate verification, specify <code>"false"</code> to verify the certificate. Defaults to <code>"false"</code> if not specified. Skipping certificate verification proceeds with an insecure migration and then the certificate is not required. Insecure migration means that the transferred data is sent over an insecure connection and potentially sensitive data could be exposed.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>When this field is not set and <em>skip certificate verification</em> is disabled, Forklift attempts to use the system CA.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify the URL of the endpoint of the API server.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Create a <code>Provider</code> manifest for the source provider:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;source_provider&gt;
  namespace: &lt;namespace&gt;
spec:
  type: openshift
  url: &lt;api_end_point&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  secret:
    name: &lt;secret&gt; <i class="conum" data-value="2"></i><b>(2)</b>
    namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the URL of the endpoint of the API server.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the name of provider <code>Secret</code> CR.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Create a <code>NetworkMap</code> manifest to map the source and destination networks:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        name: &lt;network_name&gt;
        type: pod <i class="conum" data-value="1"></i><b>(1)</b>
      source:
        name: &lt;network_name&gt;
        type: pod
    - destination:
        name: &lt;network_attachment_definition&gt; <i class="conum" data-value="2"></i><b>(2)</b>
        namespace: &lt;network_attachment_definition_namespace&gt; <i class="conum" data-value="3"></i><b>(3)</b>
        type: multus
      source:
        name: &lt;network_attachment_definition&gt;
        namespace: &lt;network_attachment_definition_namespace&gt;
        type: multus
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>pod</code> and <code>multus</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify a network attachment definition for each additional KubeVirt network. Specify the
<code>namespace</code> either by using the <code>namespace property</code> or with a name built as follows: <code>&lt;network_namespace&gt;/&lt;network_name&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Required only when <code>type</code> is <code>multus</code>. Specify the namespace of the KubeVirt network attachment definition.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>Create a <code>StorageMap</code> manifest to map source and destination storage:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: &lt;namespace&gt;
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <i class="conum" data-value="1"></i><b>(1)</b>
      source:
        name: &lt;storage_class&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>ReadWriteOnce</code> and <code>ReadWriteMany</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optional: Create a <code>Hook</code> manifest to run custom code on a VM during the phase specified in the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: &lt;namespace&gt;
spec:
  image: quay.io/konveyor/hook-runner
  playbook: |
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="paragraph">
<p><code>playbook</code> refers to an optional Base64-encoded Ansible playbook. If you specify a playbook, the <code>image</code> must be <code>hook-runner</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can use the default <code>hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="6">
<li>
<p>Create a <code>Plan</code> manifest for the migration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  namespace: &lt;namespace&gt;
spec:
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: &lt;namespace&gt;
    destination:
      name: &lt;destination_provider&gt;
      namespace: &lt;namespace&gt;
  map: <i class="conum" data-value="2"></i><b>(2)</b>
    network: <i class="conum" data-value="3"></i><b>(3)</b>
      name: &lt;network_map&gt; <i class="conum" data-value="4"></i><b>(4)</b>
      namespace: &lt;namespace&gt;
    storage: <i class="conum" data-value="5"></i><b>(5)</b>
      name: &lt;storage_map&gt; <i class="conum" data-value="6"></i><b>(6)</b>
      namespace: &lt;namespace&gt;
  targetNamespace: &lt;target_namespace&gt;
  vms:
    - name: &lt;source_vm&gt;
      namespace: &lt;namespace&gt;
      hooks: <i class="conum" data-value="7"></i><b>(7)</b>
        - hook:
            namespace: &lt;namespace&gt;
            name: &lt;hook&gt; <i class="conum" data-value="8"></i><b>(8)</b>
          step: &lt;step&gt; <i class="conum" data-value="9"></i><b>(9)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the name of the <code>Plan</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify only one network map and one storage map per plan.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify a network mapping, even if the VMs to be migrated are not assigned to a network. The mapping can be empty in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specify the name of the <code>NetworkMap</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specify a storage mapping, even if the VMs to be migrated are not assigned with disk images. The mapping can be empty in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Specify the name of the <code>StorageMap</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Specify the name of the <code>Hook</code> CR.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Allowed values are <code>PreHook</code>, before the migration plan starts, or <code>PostHook</code>, after the migration is complete.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a <code>Migration</code> manifest to run the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;name_of_migration_cr&gt;
  namespace: &lt;namespace&gt;
spec:
  plan:
    name: &lt;name_of_plan_cr&gt;
    namespace: &lt;namespace&gt;
  cutover: &lt;optional_cutover_time&gt;
EOF</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you specify a cutover time, use the ISO 8601 format with the UTC time offset, for example, <code>2024-04-04T01:23:45.678+09:00</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="canceling-migration-cli_forklift">Canceling a migration</h3>
<div class="paragraph">
<p>You can cancel an entire migration or individual virtual machines (VMs) while a migration is in progress from the command line interface (CLI).</p>
</div>
<div class="ulist">
<div class="title">Canceling an entire migration</div>
<ul>
<li>
<p>Delete the <code>Migration</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl delete migration &lt;migration&gt; -n &lt;namespace&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the name of the <code>Migration</code> CR.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Canceling the migration of individual VMs</div>
<ol class="arabic">
<li>
<p>Add the individual VMs to the <code>spec.cancel</code> block of the <code>Migration</code> manifest:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;migration&gt;
  namespace: &lt;namespace&gt;
...
spec:
  cancel:
  - id: vm-102 <i class="conum" data-value="1"></i><b>(1)</b>
  - id: vm-203
  - name: rhel8-vm
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify a VM by using the <code>id</code> key or the <code>name</code> key.
<div class="paragraph">
<p>The value of the <code>id</code> key is the <em>managed object reference</em>, for a VMware VM, or the <em>VM UUID</em>, for a oVirt VM.</p>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>Retrieve the <code>Migration</code> CR to monitor the progress of the remaining VMs:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl get migration/&lt;migration&gt; -n &lt;namespace&gt; -o yaml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-migration-options_forklift">Advanced migration options</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="changing-precopy-intervals_forklift">Changing precopy intervals for warm migration</h3>
<div class="paragraph">
<p>You can change the snapshot interval by patching the <code>ForkliftController</code> custom resource (CR).</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Patch the <code>ForkliftController</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl patch forkliftcontroller/&lt;forklift-controller&gt; -n konveyor-forklift -p '{"spec": {"controller_precopy_interval": &lt;60&gt;}}' --type=merge <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the precopy interval in minutes. The default value is <code>60</code>.
<div class="paragraph">
<p>You do not need to restart the <code>forklift-controller</code> pod.</p>
</div></td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="creating-custom-rules-for-validation-service">Creating custom rules for the Validation service</h3>
<div class="paragraph">
<p>The <code>Validation</code> service uses Open Policy Agent (OPA) policy rules to check the suitability of each virtual machine (VM) for migration. The <code>Validation</code> service generates a list of <em>concerns</em> for each VM, which are stored in the <code>Provider Inventory</code> service as VM attributes. The web console displays the concerns for each VM in the provider inventory.</p>
</div>
<div class="paragraph">
<p>You can create custom rules to extend the default ruleset of the <code>Validation</code> service. For example, you can create a rule that checks whether a VM has multiple disks.</p>
</div>
<div class="sect3">
<h4 id="about-rego-files_forklift">About Rego files</h4>
<div class="paragraph">
<p>Validation rules are written in <a href="https://www.openpolicyagent.org/docs/latest/policy-language/">Rego</a>, the Open Policy Agent (OPA) native query language. The rules are stored as <code>.rego</code> files in the <code>/usr/share/opa/policies/io/konveyor/forklift/&lt;provider&gt;</code> directory of the <code>Validation</code> pod.</p>
</div>
<div class="paragraph">
<p>Each validation rule is defined in a separate <code>.rego</code> file and tests for a specific condition. If the condition evaluates as <code>true</code>, the rule adds a <code>{“category”, “label”, “assessment”}</code> hash to the <code>concerns</code>. The <code>concerns</code> content is added to the <code>concerns</code> key in the inventory record of the VM. The web console displays the content of the <code>concerns</code> key for each VM in the provider inventory.</p>
</div>
<div class="paragraph">
<p>The following <code>.rego</code> file example checks for distributed resource scheduling enabled in the cluster of a VMware VM:</p>
</div>
<div class="listingblock">
<div class="title">drs_enabled.rego example</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">package io.konveyor.forklift.vmware <i class="conum" data-value="1"></i><b>(1)</b>

has_drs_enabled {
    input.host.cluster.drsEnabled <i class="conum" data-value="2"></i><b>(2)</b>
}

concerns[flag] {
    has_drs_enabled
    flag := {
        "category": "Information",
        "label": "VM running in a DRS-enabled cluster",
        "assessment": "Distributed resource scheduling is not currently supported by OpenShift Virtualization. The VM can be migrated but it will not have this feature in the target environment."
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each validation rule is defined within a package. The package namespaces are <code>io.konveyor.forklift.vmware</code> for VMware and <code>io.konveyor.forklift.ovirt</code> for oVirt.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Query parameters are based on the <code>input</code> key of the <code>Validation</code> service JSON.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="accessing-default-validation-rules_forklift">Checking the default validation rules</h4>
<div class="paragraph">
<p>Before you create a custom rule, you must check the default rules of the <code>Validation</code> service to ensure that you do not create a rule that redefines an existing default value.</p>
</div>
<div class="paragraph">
<p>Example: If a default rule contains the line <code>default valid_input = false</code> and you create a custom rule that contains the line <code>default valid_input = true</code>, the <code>Validation</code> service will not start.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to the terminal of the <code>Validation</code> pod:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl rsh &lt;validation_pod&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Go to the OPA policies directory for your provider:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ cd /usr/share/opa/policies/io/konveyor/forklift/&lt;provider&gt; <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify <code>vmware</code> or <code>ovirt</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Search for the default policies:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ grep -R "default" *</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="retrieving-validation-service-json_forklift">Retrieving the Inventory service JSON</h4>
<div class="paragraph">
<p>You retrieve the <code>Inventory</code> service JSON by sending an <code>Inventory</code> service query to a virtual machine (VM). The output contains an <code>"input"</code> key, which contains the inventory attributes that are queried by the <code>Validation</code> service rules.</p>
</div>
<div class="paragraph">
<p>You can create a validation rule based on any attribute in the <code>"input"</code> key, for example, <code>input.snapshot.kind</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Retrieve the routes for the project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">oc get route -n openshift-mtv</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve the <code>Inventory</code> service route:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl get route &lt;inventory_service&gt; -n konveyor-forklift</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve the access token:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ TOKEN=$(oc whoami -t)</code></pre>
</div>
</div>
</li>
<li>
<p>Trigger an HTTP GET request (for example, using Curl):</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ curl -H "Authorization: Bearer $TOKEN" https://&lt;inventory_service_route&gt;/providers -k</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve the <code>UUID</code> of a provider:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/&lt;provider&gt; -k <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values for the provider are <code>vsphere</code>, <code>ovirt</code>, and <code>openstack</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Retrieve the VMs of a provider:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/&lt;provider&gt;/&lt;UUID&gt;/vms -k</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve the details of a VM:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ curl -H "Authorization: Bearer $TOKEN"  https://&lt;inventory_service_route&gt;/providers/&lt;provider&gt;/&lt;UUID&gt;/workloads/&lt;vm&gt; -k</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">{
    "input": {
        "selfLink": "providers/vsphere/c872d364-d62b-46f0-bd42-16799f40324e/workloads/vm-431",
        "id": "vm-431",
        "parent": {
            "kind": "Folder",
            "id": "group-v22"
        },
        "revision": 1,
        "name": "iscsi-target",
        "revisionValidated": 1,
        "isTemplate": false,
        "networks": [
            {
                "kind": "Network",
                "id": "network-31"
            },
            {
                "kind": "Network",
                "id": "network-33"
            }
        ],
        "disks": [
            {
                "key": 2000,
                "file": "[iSCSI_Datastore] iscsi-target/iscsi-target-000001.vmdk",
                "datastore": {
                    "kind": "Datastore",
                    "id": "datastore-63"
                },
                "capacity": 17179869184,
                "shared": false,
                "rdm": false
            },
            {
                "key": 2001,
                "file": "[iSCSI_Datastore] iscsi-target/iscsi-target_1-000001.vmdk",
                "datastore": {
                    "kind": "Datastore",
                    "id": "datastore-63"
                },
                "capacity": 10737418240,
                "shared": false,
                "rdm": false
            }
        ],
        "concerns": [],
        "policyVersion": 5,
        "uuid": "42256329-8c3a-2a82-54fd-01d845a8bf49",
        "firmware": "bios",
        "powerState": "poweredOn",
        "connectionState": "connected",
        "snapshot": {
            "kind": "VirtualMachineSnapshot",
            "id": "snapshot-3034"
        },
        "changeTrackingEnabled": false,
        "cpuAffinity": [
            0,
            2
        ],
        "cpuHotAddEnabled": true,
        "cpuHotRemoveEnabled": false,
        "memoryHotAddEnabled": false,
        "faultToleranceEnabled": false,
        "cpuCount": 2,
        "coresPerSocket": 1,
        "memoryMB": 2048,
        "guestName": "Red Hat Enterprise Linux 7 (64-bit)",
        "balloonedMemory": 0,
        "ipAddress": "10.19.2.96",
        "storageUsed": 30436770129,
        "numaNodeAffinity": [
            "0",
            "1"
        ],
        "devices": [
            {
                "kind": "RealUSBController"
            }
        ],
        "host": {
            "id": "host-29",
            "parent": {
                "kind": "Cluster",
                "id": "domain-c26"
            },
            "revision": 1,
            "name": "IP address or host name of the vCenter host or oVirt Engine host",
            "selfLink": "providers/vsphere/c872d364-d62b-46f0-bd42-16799f40324e/hosts/host-29",
            "status": "green",
            "inMaintenance": false,
            "managementServerIp": "10.19.2.96",
            "thumbprint": &lt;thumbprint&gt;,
            "timezone": "UTC",
            "cpuSockets": 2,
            "cpuCores": 16,
            "productName": "VMware ESXi",
            "productVersion": "6.5.0",
            "networking": {
                "pNICs": [
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic0",
                        "linkSpeed": 10000
                    },
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic1",
                        "linkSpeed": 10000
                    },
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic2",
                        "linkSpeed": 10000
                    },
                    {
                        "key": "key-vim.host.PhysicalNic-vmnic3",
                        "linkSpeed": 10000
                    }
                ],
                "vNICs": [
                    {
                        "key": "key-vim.host.VirtualNic-vmk2",
                        "portGroup": "VM_Migration",
                        "dPortGroup": "",
                        "ipAddress": "192.168.79.13",
                        "subnetMask": "255.255.255.0",
                        "mtu": 9000
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk0",
                        "portGroup": "Management Network",
                        "dPortGroup": "",
                        "ipAddress": "10.19.2.13",
                        "subnetMask": "255.255.255.128",
                        "mtu": 1500
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk1",
                        "portGroup": "Storage Network",
                        "dPortGroup": "",
                        "ipAddress": "172.31.2.13",
                        "subnetMask": "255.255.0.0",
                        "mtu": 1500
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk3",
                        "portGroup": "",
                        "dPortGroup": "dvportgroup-48",
                        "ipAddress": "192.168.61.13",
                        "subnetMask": "255.255.255.0",
                        "mtu": 1500
                    },
                    {
                        "key": "key-vim.host.VirtualNic-vmk4",
                        "portGroup": "VM_DHCP_Network",
                        "dPortGroup": "",
                        "ipAddress": "10.19.2.231",
                        "subnetMask": "255.255.255.128",
                        "mtu": 1500
                    }
                ],
                "portGroups": [
                    {
                        "key": "key-vim.host.PortGroup-VM Network",
                        "name": "VM Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch0"
                    },
                    {
                        "key": "key-vim.host.PortGroup-Management Network",
                        "name": "Management Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch0"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_10G_Network",
                        "name": "VM_10G_Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_Storage",
                        "name": "VM_Storage",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_DHCP_Network",
                        "name": "VM_DHCP_Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-Storage Network",
                        "name": "Storage Network",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch1"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_Isolated_67",
                        "name": "VM_Isolated_67",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch2"
                    },
                    {
                        "key": "key-vim.host.PortGroup-VM_Migration",
                        "name": "VM_Migration",
                        "vSwitch": "key-vim.host.VirtualSwitch-vSwitch2"
                    }
                ],
                "switches": [
                    {
                        "key": "key-vim.host.VirtualSwitch-vSwitch0",
                        "name": "vSwitch0",
                        "portGroups": [
                            "key-vim.host.PortGroup-VM Network",
                            "key-vim.host.PortGroup-Management Network"
                        ],
                        "pNICs": [
                            "key-vim.host.PhysicalNic-vmnic4"
                        ]
                    },
                    {
                        "key": "key-vim.host.VirtualSwitch-vSwitch1",
                        "name": "vSwitch1",
                        "portGroups": [
                            "key-vim.host.PortGroup-VM_10G_Network",
                            "key-vim.host.PortGroup-VM_Storage",
                            "key-vim.host.PortGroup-VM_DHCP_Network",
                            "key-vim.host.PortGroup-Storage Network"
                        ],
                        "pNICs": [
                            "key-vim.host.PhysicalNic-vmnic2",
                            "key-vim.host.PhysicalNic-vmnic0"
                        ]
                    },
                    {
                        "key": "key-vim.host.VirtualSwitch-vSwitch2",
                        "name": "vSwitch2",
                        "portGroups": [
                            "key-vim.host.PortGroup-VM_Isolated_67",
                            "key-vim.host.PortGroup-VM_Migration"
                        ],
                        "pNICs": [
                            "key-vim.host.PhysicalNic-vmnic3",
                            "key-vim.host.PhysicalNic-vmnic1"
                        ]
                    }
                ]
            },
            "networks": [
                {
                    "kind": "Network",
                    "id": "network-31"
                },
                {
                    "kind": "Network",
                    "id": "network-34"
                },
                {
                    "kind": "Network",
                    "id": "network-57"
                },
                {
                    "kind": "Network",
                    "id": "network-33"
                },
                {
                    "kind": "Network",
                    "id": "dvportgroup-47"
                }
            ],
            "datastores": [
                {
                    "kind": "Datastore",
                    "id": "datastore-35"
                },
                {
                    "kind": "Datastore",
                    "id": "datastore-63"
                }
            ],
            "vms": null,
            "networkAdapters": [],
            "cluster": {
                "id": "domain-c26",
                "parent": {
                    "kind": "Folder",
                    "id": "group-h23"
                },
                "revision": 1,
                "name": "mycluster",
                "selfLink": "providers/vsphere/c872d364-d62b-46f0-bd42-16799f40324e/clusters/domain-c26",
                "folder": "group-h23",
                "networks": [
                    {
                        "kind": "Network",
                        "id": "network-31"
                    },
                    {
                        "kind": "Network",
                        "id": "network-34"
                    },
                    {
                        "kind": "Network",
                        "id": "network-57"
                    },
                    {
                        "kind": "Network",
                        "id": "network-33"
                    },
                    {
                        "kind": "Network",
                        "id": "dvportgroup-47"
                    }
                ],
                "datastores": [
                    {
                        "kind": "Datastore",
                        "id": "datastore-35"
                    },
                    {
                        "kind": "Datastore",
                        "id": "datastore-63"
                    }
                ],
                "hosts": [
                    {
                        "kind": "Host",
                        "id": "host-44"
                    },
                    {
                        "kind": "Host",
                        "id": "host-29"
                    }
                ],
                "dasEnabled": false,
                "dasVms": [],
                "drsEnabled": true,
                "drsBehavior": "fullyAutomated",
                "drsVms": [],
                "datacenter": null
            }
        }
    }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="creating-validation-rule_forklift">Creating a validation rule</h4>
<div class="paragraph">
<p>You create a validation rule by applying a config map custom resource (CR) containing the rule to the <code>Validation</code> service.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>If you create a rule with the same <em>name</em> as an existing rule, the <code>Validation</code> service performs an <code>OR</code> operation with the rules.</p>
</li>
<li>
<p>If you create a rule that contradicts a default rule, the <code>Validation</code> service will not start.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Validation rule example</div>
<p>Validation rules are based on virtual machine (VM) attributes collected by the <code>Provider Inventory</code> service.</p>
</div>
<div class="paragraph">
<p>For example, the VMware API uses this path to check whether a VMware VM has NUMA node affinity configured: <code>MOR:VirtualMachine.config.extraConfig["numa.nodeAffinity"]</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Provider Inventory</code> service simplifies this configuration and returns a testable attribute with a list value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">"numaNodeAffinity": [
    "0",
    "1"
],</code></pre>
</div>
</div>
<div class="paragraph">
<p>You create a <a href="https://www.openpolicyagent.org/docs/latest/policy-language/">Rego</a> query, based on this attribute, and add it to the <code>forklift-validation-config</code> config map:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">`count(input.numaNodeAffinity) != 0`</code></pre>
</div>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a config map CR according to the following example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: v1
kind: ConfigMap
metadata:
  name: &lt;forklift-validation-config&gt;
  namespace: konveyor-forklift
data:
  vmware_multiple_disks.rego: |-
    package &lt;provider_package&gt; <i class="conum" data-value="1"></i><b>(1)</b>

    has_multiple_disks { <i class="conum" data-value="2"></i><b>(2)</b>
      count(input.disks) &gt; 1
    }

    concerns[flag] {
      has_multiple_disks <i class="conum" data-value="3"></i><b>(3)</b>
        flag := {
          "category": "&lt;Information&gt;", <i class="conum" data-value="4"></i><b>(4)</b>
          "label": "Multiple disks detected",
          "assessment": "Multiple disks detected on this VM."
        }
    }
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the provider package name. Allowed values are <code>io.konveyor.forklift.vmware</code> for VMware and <code>io.konveyor.forklift.ovirt</code> for oVirt.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the <code>concerns</code> name and Rego query.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the <code>concerns</code> name and <code>flag</code> parameter values.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Allowed values are <code>Critical</code>, <code>Warning</code>, and <code>Information</code>.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Stop the <code>Validation</code> pod by scaling the <code>forklift-controller</code> deployment to <code>0</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl scale -n konveyor-forklift --replicas=0 deployment/forklift-controller</code></pre>
</div>
</div>
</li>
<li>
<p>Start the <code>Validation</code> pod by scaling the <code>forklift-controller</code> deployment to <code>1</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl scale -n konveyor-forklift --replicas=1 deployment/forklift-controller</code></pre>
</div>
</div>
</li>
<li>
<p>Check the <code>Validation</code> pod log to verify that the pod started:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl logs -f &lt;validation_pod&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the custom rule conflicts with a default rule, the <code>Validation</code> pod will not start.</p>
</div>
</li>
<li>
<p>Remove the source provider:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl delete provider &lt;provider&gt; -n konveyor-forklift</code></pre>
</div>
</div>
</li>
<li>
<p>Add the source provider to apply the new rule:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;provider&gt;
  namespace: konveyor-forklift
spec:
  type: &lt;provider_type&gt; <i class="conum" data-value="1"></i><b>(1)</b>
  url: &lt;api_end_point&gt; <i class="conum" data-value="2"></i><b>(2)</b>
  secret:
    name: &lt;secret&gt; <i class="conum" data-value="3"></i><b>(3)</b>
    namespace: konveyor-forklift
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allowed values are <code>ovirt</code>, <code>vsphere</code>, and <code>openstack</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specify the API end point URL, for example, <code>https://&lt;vCenter_host&gt;/sdk</code> for vSphere, <code>https://&lt;engine_host&gt;/ovirt-engine/api</code> for oVirt, or <code>https://&lt;identity_service&gt;/v3</code> for OpenStack.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specify the name of the provider <code>Secret</code> CR.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You must update the rules version after creating a custom rule so that the <code>Inventory</code> service detects the changes and validates the VMs.</p>
</div>
</div>
<div class="sect3">
<h4 id="updating-inventory-rules-version_forklift">Updating the inventory rules version</h4>
<div class="paragraph">
<p>You must update the inventory rules version each time you update the rules so that the <code>Provider Inventory</code> service detects the changes and triggers the <code>Validation</code> service.</p>
</div>
<div class="paragraph">
<p>The rules version is recorded in a <code>rules_version.rego</code> file for each provider.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Retrieve the current rules version:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ GET https://forklift-validation/v1/data/io/konveyor/forklift/&lt;provider&gt;/rules_version <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "result": {
       "rules_version": 5
   }
}</code></pre>
</div>
</div>
</li>
<li>
<p>Connect to the terminal of the <code>Validation</code> pod:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl rsh &lt;validation_pod&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Update the rules version in the <code>/usr/share/opa/policies/io/konveyor/forklift/&lt;provider&gt;/rules_version.rego</code> file.</p>
</li>
<li>
<p>Log out of the <code>Validation</code> pod terminal.</p>
</li>
<li>
<p>Verify the updated rules version:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ GET https://forklift-validation/v1/data/io/konveyor/forklift/&lt;provider&gt;/rules_version <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
   "result": {
       "rules_version": 6
   }
}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-hooks-migration-plan-using-api">Adding hooks to a migration plan</h3>
<div class="paragraph">
<p>You can add hooks a migration plan from the command line by using the Forklift API.</p>
</div>
<div class="sect3">
<h4 id="about-api-hooks-in-migration-plans_forklift">API-based hooks for Forklift migration plans</h4>
<div class="paragraph">
<p>You can add hooks to a migration plan from the command line by using the Forklift API.</p>
</div>
<h5 id="default-hook-image" class="discrete">Default hook image</h5>
<div class="paragraph">
<p>The default hook image for an Forklift hook is <code>registry.redhat.io/rhmtc/openshift-migration-hook-runner-rhel8:v1.8.2-2</code>. The image is based on the Ansible Runner image with the addition of <code>python-openshift</code> to provide Ansible Kubernetes resources and a recent <code>oc</code> binary.</p>
</div>
<h5 id="hook-execution" class="discrete">Hook execution</h5>
<div class="paragraph">
<p>An Ansible playbook that is provided as part of a migration hook is mounted into the hook container as a <code>ConfigMap</code>. The hook container is run as a job on the desired cluster, using the default <code>ServiceAccount</code> in the <code>konveyor-forklift</code> namespace.</p>
</div>
<h5 id="prehooks-and-posthooks" class="discrete">PreHooks and PostHooks</h5>
<div class="paragraph">
<p>You specify hooks per VM and you can run each as a <em>PreHook</em> or a <em>PostHook</em>. In this context, a PreHook is a hook that is run before a migration and a PostHook is a hook that is run after a migration.</p>
</div>
<div class="paragraph">
<p>When you add a hook, you must specify the namespace where the hook CR is located, the name of the hook, and specify whether the hook is a PreHook or PostHook.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order for a PreHook to run on a VM, the VM must be started and available via SSH.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example PreHook:</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: Plan
apiVersion: forklift.konveyor.io/v1beta1
metadata:
  name: test
  namespace: konveyor-forklift
spec:
  vms:
    - id: vm-2861
      hooks:
        - hook:
            namespace: konveyor-forklift
            name: playbook
          step: PreHook</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="adding-hook-crs-migration-plans-api_forklift">Adding Hook CRs to a VM migration by using the Forklift API</h4>
<div class="paragraph">
<p>You can add a <code>PreHook</code> or a <code>PostHook</code> Hook CR when you migrate a virtual machine from the command line by using the Forklift API. A <code>PreHook</code> runs before a migration, a <code>PostHook</code>, after.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can retrieve additional information stored in a secret or in a <code>configMap</code> by using a <code>k8s</code> module.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, you can create a hook CR to install <code>cloud-init</code> on a VM and write a file before migration.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>If needed, create a secret with an SSH private key for the VM. You can either use an existing key or generate a key pair, install the public key on the VM, and base64 encode the private key in the secret.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
data:
  key: VGhpcyB3YXMgZ2VuZXJhdGVkIHdpdGggc3NoLWtleWdlbiBwdXJlbHkgZm9yIHRoaXMgZXhhbXBsZS4KSXQgaXMgbm90IHVzZWQgYW55d2hlcmUuCi0tLS0tQkVHSU4gT1BFTlNTSCBQUklWQVRFIEtFWS0tLS0tCmIzQmxibk56YUMxclpYa3RkakVBQUFBQUJHNXZibVVBQUFBRWJtOXVaUUFBQUFBQUFBQUJBQUFCbHdBQUFBZHpjMmd0Y24KTmhBQUFBQXdFQUFRQUFBWUVBMzVTTFRReDBFVjdPTWJQR0FqcEsxK2JhQURTTVFuK1NBU2pyTGZLNWM5NGpHdzhDbnA4LwovRHErZHFBR1pxQkg2ZnAxYmVJM1BZZzVWVDk0RVdWQ2RrTjgwY3dEcEo0Z1R0NHFUQ1gzZUYvY2x5VXQyUC9zaTNjcnQ0CjBQdi9wVnZXU1U2TlhHaDJIZC93V0MwcGh5Z0RQOVc5SHRQSUF0OFpnZmV2ZnUwZHpraVl6OHNVaElWU2ZsRGpaNUFqcUcKUjV2TVVUaGlrczEvZVlCeTdiMkFFSEdzYU8xN3NFbWNiYUlHUHZuUFVwWmQrdjkyYU1JdWZoYjhLZkFSbzZ3Ty9ISW1VbQovdDdHWFBJUmxBMUhSV0p1U05odTQzZS9DY3ZYd3Z6RnZrdE9kYXlEQzBMTklHMkpVaURlNWd0UUQ1WHZXc1p3MHQvbEs1CklacjFrZXZRNUJsYWNISmViV1ZNYUQvdllpdFdhSFo4OEF1Y0czaGh2bjkrOGNSTGhNVExiVlFSMWh2UVpBL1JtQXN3eE0KT3VJSmRaUmtxTThLZlF4Z28zQThRNGJhQW1VbnpvM3Zwa0FWdC9uaGtIOTRaRE5rV2U2RlRhdThONStyYTJCZkdjZVA4VApvbjFEeTBLRlpaUlpCREVVRVc0eHdTYUVOYXQ3c2RDNnhpL1d5OURaQUFBRm1NRFBXeDdBejFzZUFBQUFCM056YUMxeWMyCkVBQUFHQkFOK1VpMDBNZEJGZXpqR3p4Z0k2U3RmbTJnQTBqRUova2dFbzZ5M3l1WFBlSXhzUEFwNmZQL3c2dm5hZ0JtYWcKUituNmRXM2lOejJJT1ZVL2VCRmxRblpEZk5ITUE2U2VJRTdlS2t3bDkzaGYzSmNsTGRqLzdJdDNLN2VORDcvNlZiMWtsTwpqVnhvZGgzZjhGZ3RLWWNvQXovVnZSN1R5QUxmR1lIM3IzN3RIYzVJbU0vTEZJU0ZVbjVRNDJlUUk2aGtlYnpGRTRZcExOCmYzbUFjdTI5Z0JCeHJHanRlN0JKbkcyaUJqNzV6MUtXWGZyL2RtakNMbjRXL0Nud0VhT3NEdnh5SmxKdjdleGx6eUVaUU4KUjBWaWJrallidU4zdnduTDE4TDh4YjVMVG5Xc2d3dEN6U0J0aVZJZzN1WUxVQStWNzFyR2NOTGY1U3VTR2E5WkhyME9RWgpXbkJ5WG0xbFRHZy83MklyVm1oMmZQQUxuQnQ0WWI1L2Z2SEVTNFRFeTIxVUVkWWIwR1FQMFpnTE1NVERyaUNYV1VaS2pQCkNuME1ZS053UEVPRzJnSmxKODZONzZaQUZiZjU0WkIvZUdRelpGbnVoVTJydkRlZnEydGdYeG5Iai9FNko5UTh0Q2hXV1UKV1FReEZCRnVNY0VtaERXcmU3SFF1c1l2MXN2UTJRQUFBQU1CQUFFQUFBR0JBSlZtZklNNjdDQmpXcU9KdnFua2EvakRrUwo4TDdpSE5mekg1TnRZWVdPWmRMTlk2L0lRa1pDeFcwTWtSKzlUK0M3QUZKZzBNV2Q5ck5PeUxJZDkxNjZoOVJsNG0xdFJjCnViZ1o2dWZCZ3hGVDlXS21mSEdCNm4zelh5b2pQOEFJTnR6ODVpaUVHVXFFRWtVRVdMd0RGSmdvcFllQ3l1VmZ2ZE92MUgKRm1WWmEwNVo0b3NQNkNENXVmc2djQ1RYQTR6VnZ5ZHVCYkxqdHN5RjdYZjNUdjZUQ1QxU0swZHErQk1OOXRvb0RZaXpwagpzbDh6NzlybXp3eUFyWFlVcnFUUkpsNmpwRkNrWHJLcy9LeG96MHhhbXlMY2RORk9hWE51LzlnTkpjRERsV2hPcFRqNHk4CkpkNXBuV1Jueis1RHJLRFdhY0loUW1CMUxVd2ZLWmQwbVFxaUpzMUMxcXZVUmlKOGExaThKUTI4bHFuWTFRRk9wbk13emcKWEpla2FndThpT1ExRFJlQkhaM0NkcVJUYnY3bVJZSGxramx0dXJmZGc4M3hvM0ErZ1JSR001eUVOcW5xSkplQjhJQVB5UwptMFp0dGdqbHNqNTJ2K1B1NmExMHoxZndKK1VML2N6dTRKeEpOYlp6WTFIMnpLODJBaVI1T3JYNmx2aUEvSWFSRVcwUUFBCkFNQndVeUJpcUc5bEZCUnltL2UvU1VORVMzdHpicUZNdTdIcy84WTV5SnAxKzR6OXUxNGtJR2ttV0Y5eE5HT3hrY3V0cWwKeHVUcndMbjFUaFNQTHQrTjUwTGhVdzR4ZjBhNUxqemdPbklPU0FRbm5HY1Nxa0dTRDlMR21obGE2WmpydFBHY29lQ3JHdAo5M1Vvcmx5YkxNRzFFRFAxWmpKS1RaZzl6OUMwdDlTTGd3ei9DbFhydW9UNXNQVUdKWnUrbHlIZXpSTDRtcHl6OEZMcnlOCkdNci9leVM5bWdISjNVVkZEYjNIZ3BaK1E1SUdBRU5rZVZEcHIwMGhCZXZndGd6YWtBQUFEQkFQVXQ1RitoMnBVby94V1YKenRkcVQvMzA4dFB5MXVMMU1lWFoydEJPQmRwSDJyd0JzdWt0aTIySGtWZUZXQjJFdUlFUXppMzY3MGc1UGdxR1p4Vng4dQpobEE0Rkg4ZXN1NTNQckZqVW9EeFJhb3d3WXBFcFh5Y2pnNUE1MStwR1VQcWljWjB0YjliaWlhc3BWWXZhWW5sdGlnVG5iClN0UExMY29nemNiL0dGcVYyaXlzc3lwTlMwKzBNRTUxcEtxWGNaS2swbi8vVHpZWWs4TW8vZzRsQ3pmUEZQUlZrVVM5blIKWU1pQzRlcEk0TERmbVdnM0xLQ2N1Zk85all3aWgwYlFBQUFNRUE2WEtldDhEMHNvc0puZVh5WFZGd0dyVyszNlhBVGRQTwpMWDdjaStjYzFoOGV1eHdYQWx3aTJJNFhxSmJBVjBsVEhuVGEycXN3Uy9RQlpJUUJWSkZlVjVyS1daZTc4R2F3d1pWTFZNCldETmNwdFFyRTFaM2pGNS9TdUVzdlVxSDE0Tkc5RUFXWG1iUkNzelE0Vlk3NzQrSi9sTFkvMnlDT1diNzlLYTJ5OGxvYUoKVXczWWVtSld3blp2R3hKNldsL3BmQ2xYN3lEVXlXUktLdGl0cWNjbmpCWVkyRE1tZURwdURDYy9ZdDZDc3dLRmRkMkJ1UwpGZGt5cDlZY3VMaDlLZEFBQUFIR3BoYzI5dVFFRlVMVGd3TWxVdWJXOXVkR3hsYjI0dWFXNTBjbUVCQWdNRUJRWT0KLS0tLS1FTkQgT1BFTlNTSCBQUklWQVRFIEtFWS0tLS0tCgo=
kind: Secret
metadata:
  name: ssh-credentials
  namespace: konveyor-forklift
type: Opaque</code></pre>
</div>
</div>
</li>
<li>
<p>Encode your playbook by conncatenating a file and piping it for base64, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ cat playbook.yml | base64 -w0</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also use a here document to encode a playbook:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ cat &lt;&lt; EOF | base64 -w0
- hosts: localhost
  tasks:
  - debug:
      msg: test
EOF</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a Hook CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: playbook
  namespace: konveyor-forklift
spec:
  image: registry.redhat.io/rhmtc/openshift-migration-hook-runner-rhel8:v1.8.2-2
  playbook: LSBuYW1lOiBNYWluCiAgaG9zdHM6IGxvY2FsaG9zdAogIHRhc2tzOgogIC0gbmFtZTogTG9hZCBQbGFuCiAgICBpbmNsdWRlX3ZhcnM6CiAgICAgIGZpbGU6IHBsYW4ueW1sCiAgICAgIG5hbWU6IHBsYW4KCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3ZhcnM6CiAgICAgIGZpbGU6IHdvcmtsb2FkLnltbAogICAgICBuYW1lOiB3b3JrbG9hZAoKICAtIG5hbWU6IAogICAgZ2V0ZW50OgogICAgICBkYXRhYmFzZTogcGFzc3dkCiAgICAgIGtleTogInt7IGFuc2libGVfdXNlcl9pZCB9fSIKICAgICAgc3BsaXQ6ICc6JwoKICAtIG5hbWU6IEVuc3VyZSBTU0ggZGlyZWN0b3J5IGV4aXN0cwogICAgZmlsZToKICAgICAgcGF0aDogfi8uc3NoCiAgICAgIHN0YXRlOiBkaXJlY3RvcnkKICAgICAgbW9kZTogMDc1MAogICAgZW52aXJvbm1lbnQ6CiAgICAgIEhPTUU6ICJ7eyBhbnNpYmxlX2ZhY3RzLmdldGVudF9wYXNzd2RbYW5zaWJsZV91c2VyX2lkXVs0XSB9fSIKCiAgLSBrOHNfaW5mbzoKICAgICAgYXBpX3ZlcnNpb246IHYxCiAgICAgIGtpbmQ6IFNlY3JldAogICAgICBuYW1lOiBzc2gtY3JlZGVudGlhbHMKICAgICAgbmFtZXNwYWNlOiBrb252ZXlvci1mb3JrbGlmdAogICAgcmVnaXN0ZXI6IHNzaF9jcmVkZW50aWFscwoKICAtIG5hbWU6IENyZWF0ZSBTU0gga2V5CiAgICBjb3B5OgogICAgICBkZXN0OiB+Ly5zc2gvaWRfcnNhCiAgICAgIGNvbnRlbnQ6ICJ7eyBzc2hfY3JlZGVudGlhbHMucmVzb3VyY2VzWzBdLmRhdGEua2V5IHwgYjY0ZGVjb2RlIH19IgogICAgICBtb2RlOiAwNjAwCgogIC0gYWRkX2hvc3Q6CiAgICAgIG5hbWU6ICJ7eyB3b3JrbG9hZC52bS5pcGFkZHJlc3MgfX0iCiAgICAgIGFuc2libGVfdXNlcjogcm9vdAogICAgICBncm91cHM6IHZtcwoKLSBob3N0czogdm1zCiAgdGFza3M6CiAgLSBuYW1lOiBJbnN0YWxsIGNsb3VkLWluaXQKICAgIGRuZjoKICAgICAgbmFtZToKICAgICAgLSBjbG91ZC1pbml0CiAgICAgIHN0YXRlOiBsYXRlc3QKCiAgLSBuYW1lOiBDcmVhdGUgVGVzdCBGaWxlCiAgICBjb3B5OgogICAgICBkZXN0OiAvdGVzdC50eHQKICAgICAgY29udGVudDogIkhlbGxvIFdvcmxkIgogICAgICBtb2RlOiAwNjQ0Cg==
  serviceAccount: forklift-controller <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify a <code>serviceAccount</code> to run the hook with in order to control access to resources on the cluster.
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To decode an attached playbook retrieve the resource with custom output and pipe it to base64. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell"> oc get -n konveyor-forklift hook playbook -o \
   go-template='{{ .spec.playbook }}' | base64 -d</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The playbook encoded here runs the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">- name: Main
  hosts: localhost
  tasks:
  - name: Load Plan
    include_vars:
      file: plan.yml
      name: plan

  - name: Load Workload
    include_vars:
      file: workload.yml
      name: workload

  - name:
    getent:
      database: passwd
      key: "{{ ansible_user_id }}"
      split: ':'

  - name: Ensure SSH directory exists
    file:
      path: ~/.ssh
      state: directory
      mode: 0750
    environment:
      HOME: "{{ ansible_facts.getent_passwd[ansible_user_id][4] }}"

  - k8s_info:
      api_version: v1
      kind: Secret
      name: ssh-credentials
      namespace: konveyor-forklift
    register: ssh_credentials

  - name: Create SSH key
    copy:
      dest: ~/.ssh/id_rsa
      content: "{{ ssh_credentials.resources[0].data.key | b64decode }}"
      mode: 0600

  - add_host:
      name: "{{ workload.vm.ipaddress }}"
      ansible_user: root
      groups: vms

- hosts: vms
  tasks:
  - name: Install cloud-init
    dnf:
      name:
      - cloud-init
      state: latest

  - name: Create Test File
    copy:
      dest: /test.txt
      content: "Hello World"
      mode: 0644</code></pre>
</div>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a Plan CR using the hook:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">kind: Plan
apiVersion: forklift.konveyor.io/v1beta1
metadata:
  name: test
  namespace: konveyor-forklift
spec:
  map:
    network:
      namespace: "konveyor-forklift"
      name: "network"
    storage:
      namespace: "konveyor-forklift"
      name: "storage"
  provider:
    source:
      namespace: "konveyor-forklift"
      name: "boston"
    destination:
      namespace: "konveyor-forklift"
      name: host
  targetNamespace: "konveyor-forklift"
  vms:
    - id: vm-2861
      hooks:
        - hook:
            namespace: konveyor-forklift
            name: playbook
          step: PreHook <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Options are <code>PreHook</code>, to run the hook before the migration, and <code>PostHook</code>, to run the hook after the migration.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In order for a PreHook to run on a VM, the VM must be started and available via SSH.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="upgrading-mtv-ui_forklift">Upgrading  Forklift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can upgrade the Forklift Operator by using the OKD web console to install the new version.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Operators</strong> &#8594; <strong>Installed Operators</strong> &#8594; <strong>Migration Toolkit for Virtualization Operator</strong> &#8594; <strong>Subscription</strong>.</p>
</li>
<li>
<p>Change the update channel to the correct release.</p>
<div class="paragraph">
<p>See <a href="https://docs.okd.io/latest/operators/admin/olm-upgrading-operators.html#olm-changing-update-channel_olm-upgrading-operators">Changing update channel</a> in the OKD documentation.</p>
</div>
</li>
<li>
<p>Confirm that <strong>Upgrade status</strong> changes from <strong>Up to date</strong> to <strong>Upgrade available</strong>. If it does not, restart the <code>CatalogSource</code> pod:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Note the catalog source, for example, <code>redhat-operators</code>.</p>
</li>
<li>
<p>From the command line, retrieve the catalog source pod:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl get pod -n openshift-marketplace | grep &lt;catalog_source&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the pod:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl delete pod -n openshift-marketplace &lt;catalog_source_pod&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Upgrade status</strong> changes from <strong>Up to date</strong> to <strong>Upgrade available</strong>.</p>
</div>
<div class="paragraph">
<p>If you set <strong>Update approval</strong> on the <strong>Subscriptions</strong> tab to <strong>Automatic</strong>, the upgrade starts automatically.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you set <strong>Update approval</strong> on the <strong>Subscriptions</strong> tab to <strong>Manual</strong>, approve the upgrade.</p>
<div class="paragraph">
<p>See <a href="https://docs.okd.io/latest/operators/admin/olm-upgrading-operators.html#olm-approving-pending-upgrade_olm-upgrading-operators">Manually approving a pending upgrade</a> in the OKD documentation.</p>
</div>
</li>
<li>
<p>If you are upgrading from Forklift 2.2 and have defined VMware source providers, edit the VMware provider by adding a VDDK <code>init</code> image. Otherwise, the update will change the state of any VMware providers to <code>Critical</code>. For more information, see <a href="https://access.redhat.com/documentation/en-us/migration_toolkit_for_virtualization/2.4/html/installing_and_using_the_migration_toolkit_for_virtualization/migrating-vms-web-console#adding-source-provider_vmware">Adding a VMSphere source provider</a>.</p>
</li>
<li>
<p>If you mapped to NFS on the OKD destination provider in Forklift 2.2, edit the <code>AccessModes</code> and <code>VolumeMode</code> parameters in the NFS storage profile. Otherwise, the upgrade will invalidate the NFS mapping. For more information, see <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.9/html-single/virtualization/index#virt-customizing-storage-profile_virt-creating-data-volumes">Customizing the storage profile</a>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="uninstalling-mtv_forklift">Uninstalling  Forklift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can uninstall  Forklift by using the OKD web console or the command line interface (CLI).</p>
</div>
<div class="sect2">
<h3 id="uninstalling-mtv-ui_forklift">Uninstalling Forklift by using the OKD web console</h3>
<div class="paragraph">
<p>You can uninstall Forklift by using the OKD web console to delete the <code>konveyor-forklift</code> project and custom resource definitions (CRDs).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must be logged in as a user with <code>cluster-admin</code> privileges.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <strong>Home</strong> &#8594; <strong>Projects</strong>.</p>
</li>
<li>
<p>Locate the <strong>konveyor-forklift</strong> project.</p>
</li>
<li>
<p>On the right side of the project, select <strong>Delete Project</strong> from the Options menu <span class="image"><img src="../modules/images/kebab.png" alt="kebab" height="20" title="Options menu"></span>.</p>
</li>
<li>
<p>In the <strong>Delete Project</strong> pane, enter the project name and click <strong>Delete</strong>.</p>
</li>
<li>
<p>Click <strong>Administration</strong> &#8594; <strong>CustomResourceDefinitions</strong>.</p>
</li>
<li>
<p>Enter <code>forklift</code> in the <strong>Search</strong> field to locate the CRDs in the <code>forklift.konveyor.io</code> group.</p>
</li>
<li>
<p>On the right side of each CRD, select <strong>Delete CustomResourceDefinition</strong> from the Options menu <span class="image"><img src="../modules/images/kebab.png" alt="kebab" height="20" title="Options menu"></span>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="uninstalling-mtv-cli_forklift">Uninstalling Forklift from the command line interface</h3>
<div class="paragraph">
<p>You can uninstall Forklift from the command line interface (CLI) by deleting the <code>konveyor-forklift</code> project and the <code>forklift.konveyor.io</code> custom resource definitions (CRDs).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must be logged in as a user with <code>cluster-admin</code> privileges.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Delete the project:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl delete project konveyor-forklift</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the CRDs:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl get crd -o name | grep 'forklift' | xargs kubectl delete</code></pre>
</div>
</div>
</li>
<li>
<p>Delete the OAuthClient:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl delete oauthclient/forklift-ui</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="troubleshooting_forklift">Troubleshooting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides information for troubleshooting common migration issues.</p>
</div>
<div class="sect2">
<h3 id="error-messages_forklift">Error messages</h3>
<div class="paragraph">
<p>This section describes error messages and how to resolve them.</p>
</div>
<div class="paragraph">
<div class="title">warm import retry limit reached</div>
<p>The <code>warm import retry limit reached</code> error message is displayed during a warm migration if a VMware virtual machine (VM) has reached the maximum number (28) of changed block tracking (CBT) snapshots during the precopy stage.</p>
</div>
<div class="paragraph">
<p>To resolve this problem, delete some of the CBT snapshots from the VM and restart the migration plan.</p>
</div>
<div class="paragraph">
<div class="title">Unable to resize disk image to required size</div>
<p>The <code>Unable to resize disk image to required size</code> error message is displayed when migration fails because a virtual machine on the target provider uses persistent volumes with an EXT4 file system on block storage. The problem occurs because the default overhead that is assumed by CDI does not completely include the reserved place for the root partition.</p>
</div>
<div class="paragraph">
<p>To resolve this problem, increase the file system overhead in CDI to more than 10%.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-must-gather_forklift">Using the must-gather tool</h3>
<div class="paragraph">
<p>You can collect logs and information about Forklift custom resources (CRs) by using the <code>must-gather</code> tool. You must attach a <code>must-gather</code> data file to all customer cases.</p>
</div>
<div class="paragraph">
<p>You can gather data for a specific namespace, migration plan, or virtual machine (VM) by using the filtering options.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you specify a non-existent resource in the filtered <code>must-gather</code> command, no archive file is created.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must be logged in to the KubeVirt cluster as a user with the <code>cluster-admin</code> role.</p>
</li>
<li>
<p>You must have the <a href="https://docs.openshift.com/container-platform/4.10/cli_reference/openshift_cli/getting-started-cli.html">OKD CLI (<code>oc</code>)</a> installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Collecting logs and CR information</div>
<ol class="arabic">
<li>
<p>Navigate to the directory where you want to store the <code>must-gather</code> data.</p>
</li>
<li>
<p>Run the <code>oc adm must-gather</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc adm must-gather --image=quay.io/konveyor/forklift-must-gather:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data is saved as <code>/must-gather/must-gather.tar.gz</code>. You can upload this file to a support case on the <a href="https://access.redhat.com/">Red Hat Customer Portal</a>.</p>
</div>
</li>
<li>
<p>Optional: Run the <code>oc adm must-gather</code> command with the following options to gather filtered data:</p>
<div class="ulist">
<ul>
<li>
<p>Namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc adm must-gather --image=quay.io/konveyor/forklift-must-gather:latest \
  -- NS=&lt;namespace&gt; /usr/bin/targeted</code></pre>
</div>
</div>
</li>
<li>
<p>Migration plan:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc adm must-gather --image=quay.io/konveyor/forklift-must-gather:latest \
  -- PLAN=&lt;migration_plan&gt; /usr/bin/targeted</code></pre>
</div>
</div>
</li>
<li>
<p>Virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc adm must-gather --image=quay.io/konveyor/forklift-must-gather:latest \
  -- VM=&lt;vm_id&gt; NS=&lt;namespace&gt; /usr/bin/targeted <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the VM <em>ID</em> as it appears in the <code>Plan</code> CR.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="architecture_forklift">Architecture</h3>
<div class="paragraph">
<p>This section describes Forklift custom resources, services, and workflows.</p>
</div>
<div class="sect3">
<h4 id="mtv-resources-and-services_forklift">Forklift custom resources and services</h4>
<div class="paragraph">
<p> Forklift is provided as an OKD Operator. It creates and manages the following custom resources (CRs) and services.</p>
</div>
<div class="ulist">
<div class="title">Forklift custom resources</div>
<ul>
<li>
<p><code>Provider</code> CR stores attributes that enable Forklift to connect to and interact with the source and target providers.</p>
</li>
<li>
<p><code>NetworkMapping</code> CR maps the networks of the source and target providers.</p>
</li>
<li>
<p><code>StorageMapping</code> CR maps the storage of the source and target providers.</p>
</li>
<li>
<p><code>Plan</code> CR contains a list of VMs with the same migration parameters and associated network and storage mappings.</p>
</li>
<li>
<p><code>Migration</code> CR runs a migration plan.</p>
<div class="paragraph">
<p>Only one <code>Migration</code> CR per migration plan can run at a given time. You can create multiple <code>Migration</code> CRs for a single <code>Plan</code> CR.</p>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Forklift services</div>
<ul>
<li>
<p>The <code>Inventory</code> service performs the following actions:</p>
<div class="ulist">
<ul>
<li>
<p>Connects to the source and target providers.</p>
</li>
<li>
<p>Maintains a local inventory for mappings and plans.</p>
</li>
<li>
<p>Stores VM configurations.</p>
</li>
<li>
<p>Runs the <code>Validation</code> service if a VM configuration change is detected.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>Validation</code> service checks the suitability of a VM for migration by applying rules.</p>
</li>
<li>
<p>The <code>Migration Controller</code> service orchestrates migrations.</p>
<div class="paragraph">
<p>When you create a migration plan, the <code>Migration Controller</code> service validates the plan and adds a status label. If the plan fails validation, the plan status is <code>Not ready</code> and the plan cannot be used to perform a migration. If the plan passes validation, the plan status is <code>Ready</code> and it can be used to perform a migration. After a successful migration, the <code>Migration Controller</code> service changes the plan status to <code>Completed</code>.</p>
</div>
</li>
<li>
<p>The <code>Populator Controller</code> service orchestrates disk transfers using Volume Populators.</p>
</li>
<li>
<p>The <code>Kubevirt Controller</code> and <code>Containerized Data Import (CDI) Controller</code> services handle most technical operations.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="mtv-workflow_forklift">High-level migration workflow</h4>
<div class="paragraph">
<p>The high-level workflow shows the migration process from the point of view of the user:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You create a source provider, a target provider, a network mapping, and a storage mapping.</p>
</li>
<li>
<p>You create a <code>Plan</code> custom resource (CR) that includes the following resources:</p>
<div class="ulist">
<ul>
<li>
<p>Source provider</p>
</li>
<li>
<p>Target provider, if Forklift is not installed on the target cluster</p>
</li>
<li>
<p>Network mapping</p>
</li>
<li>
<p>Storage mapping</p>
</li>
<li>
<p>One or more virtual machines (VMs)</p>
</li>
</ul>
</div>
</li>
<li>
<p>You run a migration plan by creating a <code>Migration</code> CR that references the <code>Plan</code> CR.</p>
<div class="paragraph">
<p>If you cannot migrate all the VMs for any reason, you can create multiple <code>Migration</code> CRs for the same <code>Plan</code> CR until all VMs are migrated.</p>
</div>
</li>
<li>
<p>For each VM in the <code>Plan</code> CR, the <code>Migration Controller</code> service records the VM migration progress in the <code>Migration</code> CR.</p>
</li>
<li>
<p>Once the data transfer for each VM in the <code>Plan</code> CR completes, the <code>Migration Controller</code> service creates a <code>VirtualMachine</code> CR.</p>
<div class="paragraph">
<p>When all VMs have been migrated, the <code>Migration Controller</code> service updates the status of the <code>Plan</code> CR to <code>Completed</code>. The power state of each source VM is maintained after migration.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="virt-migration-workflow_forklift">Detailed migration workflow</h4>
<div class="paragraph">
<p>You can use the detailed migration workflow to troubleshoot a failed migration.</p>
</div>
<div class="paragraph">
<p>The workflow describes the following steps:</p>
</div>
<div class="paragraph">
<p><strong>Warm Migration or migration to a remote OpenShift cluster:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When you create the <code>Migration</code> custom resource (CR) to run a migration plan, the <code>Migration Controller</code> service creates a <code>DataVolume</code> CR for each source VM disk.</p>
<div class="paragraph">
<p><strong>For each VM disk:</strong></p>
</div>
</li>
<li>
<p>The <code>Containerized Data Importer (CDI) Controller</code> service creates a persistent volume claim (PVC) based on the parameters specified in the <code>DataVolume</code> CR.  </p>
</li>
<li>
<p>If the <code>StorageClass</code> has a dynamic provisioner, the persistent volume (PV) is dynamically provisioned by the <code>StorageClass</code> provisioner.</p>
</li>
<li>
<p>The <code>CDI Controller</code> service creates an <code>importer</code> pod.</p>
</li>
<li>
<p>The <code>importer</code> pod streams the VM disk to the PV.</p>
<div class="paragraph">
<p><strong>After the VM disks are transferred:</strong></p>
</div>
</li>
<li>
<p>The <code>Migration Controller</code> service creates a <code>conversion</code> pod with the PVCs attached to it when importing from VMWare.</p>
<div class="paragraph">
<p>The <code>conversion</code> pod runs <code>virt-v2v</code>, which installs and configures device drivers on the PVCs of the target VM.</p>
</div>
</li>
<li>
<p>The <code>Migration Controller</code> service creates a <code>VirtualMachine</code> CR for each source virtual machine (VM), connected to the PVCs.</p>
</li>
<li>
<p>If the VM ran on the source environment, the <code>Migration Controller</code> powers on the VM, the <code>KubeVirt Controller</code> service creates a <code>virt-launcher</code> pod and a <code>VirtualMachineInstance</code> CR.</p>
<div class="paragraph">
<p>The <code>virt-launcher</code> pod runs <code>QEMU-KVM</code> with the PVCs attached as VM disks.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Cold migration from oVirt or OpenStack to the local OpenShift cluster:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When you create a <code>Migration</code> custom resource (CR) to run a migration plan, the <code>Migration Controller</code> service creates for each source VM disk a <code>PersistentVolumeClaim</code> CR, and an <code>OvirtVolumePopulator</code> when the source is oVirt, or an <code>OpenstackVolumePopulator</code> CR  when the source is OpenStack.</p>
<div class="paragraph">
<p><strong>For each VM disk:</strong></p>
</div>
</li>
<li>
<p>The <code>Populator Controller</code> service creates a temporarily persistent volume claim (PVC).</p>
</li>
<li>
<p>If the <code>StorageClass</code> has a dynamic provisioner, the persistent volume (PV) is dynamically provisioned by the <code>StorageClass</code> provisioner.</p>
<div class="ulist">
<ul>
<li>
<p>The <code>Migration Controller</code> service creates a dummy pod to bind <strong>all PVCs</strong>. The name of the pod contains <code>pvcinit</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>Populator Controller</code> service creates a <code>populator</code> pod.</p>
</li>
<li>
<p>The <code>populator</code> pod transfers the disk data to the PV.</p>
<div class="paragraph">
<p><strong>After the VM disks are transferred:</strong></p>
</div>
</li>
<li>
<p>The temporary PVC is deleted, and the initial PVC points to the PV with the data.</p>
</li>
<li>
<p>The <code>Migration Controller</code> service creates a <code>VirtualMachine</code> CR for each source virtual machine (VM), connected to the PVCs.</p>
</li>
<li>
<p>If the VM ran on the source environment, the <code>Migration Controller</code> powers on the VM, the <code>KubeVirt Controller</code> service creates a <code>virt-launcher</code> pod and a <code>VirtualMachineInstance</code> CR.</p>
<div class="paragraph">
<p>The <code>virt-launcher</code> pod runs <code>QEMU-KVM</code> with the PVCs attached as VM disks.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Cold migration from VMWare to the local OpenShift cluster:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When you create a <code>Migration</code> custom resource (CR) to run a migration plan, the <code>Migration Controller</code> service creates a <code>DataVolume</code> CR for each source VM disk.</p>
<div class="paragraph">
<p><strong>For each VM disk:</strong></p>
</div>
</li>
<li>
<p>The <code>Containerized Data Importer (CDI) Controller</code> service creates a blank persistent volume claim (PVC) based on the parameters specified in the <code>DataVolume</code> CR.  </p>
</li>
<li>
<p>If the <code>StorageClass</code> has a dynamic provisioner, the persistent volume (PV) is dynamically provisioned by the <code>StorageClass</code> provisioner.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>For all VM disks:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>Migration Controller</code> service creates a dummy pod to bind <strong>all PVCs</strong>. The name of the pod contains <code>pvcinit</code>.</p>
</li>
<li>
<p>The <code>Migration Controller</code> service creates a <code>conversion</code> pod for all PVCs.</p>
</li>
<li>
<p>The <code>conversion</code> pod runs <code>virt-v2v</code>, which converts the VM to the KVM hypervisor and transfers the disks' data to their corresponding PVs.</p>
<div class="paragraph">
<p><strong>After the VM disks are transferred:</strong></p>
</div>
</li>
<li>
<p>The <code>Migration Controller</code> service creates a <code>VirtualMachine</code> CR for each source virtual machine (VM), connected to the PVCs.</p>
</li>
<li>
<p>If the VM ran on the source environment, the <code>Migration Controller</code> powers on the VM, the <code>KubeVirt Controller</code> service creates a <code>virt-launcher</code> pod and a <code>VirtualMachineInstance</code> CR.</p>
<div class="paragraph">
<p>The <code>virt-launcher</code> pod runs <code>QEMU-KVM</code> with the PVCs attached as VM disks.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logs-and-crs_forklift">Logs and custom resources</h3>
<div class="paragraph">
<p>You can download logs and custom resource (CR) information for troubleshooting. For more information, see the <a href="#virt-migration-workflow_forklift">detailed migration workflow</a>.</p>
</div>
<div class="sect3">
<h4 id="collected-logs-cr-info_forklift">Collected logs and custom resource information</h4>
<div class="paragraph">
<p>You can download logs and custom resource (CR) <code>yaml</code> files for the following targets by using the OKD web console or the command line interface (CLI):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Migration plan: Web console or CLI.</p>
</li>
<li>
<p>Virtual machine: Web console or CLI.</p>
</li>
<li>
<p>Namespace: CLI only.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>must-gather</code> tool collects the following logs and CR files in an archive file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CRs:</p>
<div class="ulist">
<ul>
<li>
<p><code>DataVolume</code> CR: Represents a disk mounted on a migrated VM.</p>
</li>
<li>
<p><code>VirtualMachine</code> CR: Represents a migrated VM.</p>
</li>
<li>
<p><code>Plan</code> CR: Defines the VMs and storage and network mapping.</p>
</li>
<li>
<p><code>Job</code> CR: Optional: Represents a pre-migration hook, a post-migration hook, or both.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Logs:</p>
<div class="ulist">
<ul>
<li>
<p><code>importer</code> pod: Disk-to-data-volume conversion log. The <code>importer</code> pod naming convention is <code>importer-&lt;migration_plan&gt;-&lt;vm_id&gt;&lt;5_char_id&gt;</code>, for example, <code>importer-mig-plan-ed90dfc6-9a17-4a8btnfh</code>, where <code>ed90dfc6-9a17-4a8</code> is a truncated oVirt VM ID and <code>btnfh</code> is the generated 5-character ID.</p>
</li>
<li>
<p><code>conversion</code> pod: VM conversion log. The <code>conversion</code> pod runs <code>virt-v2v</code>, which installs and configures device drivers on the PVCs of the VM. The <code>conversion</code> pod naming convention is <code>&lt;migration_plan&gt;-&lt;vm_id&gt;&lt;5_char_id&gt;</code>.</p>
</li>
<li>
<p><code>virt-launcher</code> pod: VM launcher log. When a migrated VM is powered on, the <code>virt-launcher</code> pod runs <code>QEMU-KVM</code> with the PVCs attached as VM disks.</p>
</li>
<li>
<p><code>forklift-controller</code> pod: The log is filtered for the migration plan, virtual machine, or namespace specified by the <code>must-gather</code> command.</p>
</li>
<li>
<p><code>forklift-must-gather-api</code> pod: The log is filtered for the migration plan, virtual machine, or namespace specified by the <code>must-gather</code> command.</p>
</li>
<li>
<p><code>hook-job</code> pod: The log is filtered for hook jobs. The <code>hook-job</code> naming convention is <code>&lt;migration_plan&gt;-&lt;vm_id&gt;&lt;5_char_id&gt;</code>, for example, <code>plan2j-vm-3696-posthook-4mx85</code> or <code>plan2j-vm-3696-prehook-mwqnl</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Empty or excluded log files are not included in the <code>must-gather</code> archive file.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Example must-gather archive structure for a VMware migration plan</div>
<div class="content">
<pre>must-gather
└── namespaces
    ├── target-vm-ns
    │   ├── crs
    │   │   ├── datavolume
    │   │   │   ├── mig-plan-vm-7595-tkhdz.yaml
    │   │   │   ├── mig-plan-vm-7595-5qvqp.yaml
    │   │   │   └── mig-plan-vm-8325-xccfw.yaml
    │   │   └── virtualmachine
    │   │       ├── test-test-rhel8-2disks2nics.yaml
    │   │       └── test-x2019.yaml
    │   └── logs
    │       ├── importer-mig-plan-vm-7595-tkhdz
    │       │   └── current.log
    │       ├── importer-mig-plan-vm-7595-5qvqp
    │       │   └── current.log
    │       ├── importer-mig-plan-vm-8325-xccfw
    │       │   └── current.log
    │       ├── mig-plan-vm-7595-4glzd
    │       │   └── current.log
    │       └── mig-plan-vm-8325-4zw49
    │           └── current.log
    └── openshift-mtv
        ├── crs
        │   └── plan
        │       └── mig-plan-cold.yaml
        └── logs
            ├── forklift-controller-67656d574-w74md
            │   └── current.log
            └── forklift-must-gather-api-89fc7f4b6-hlwb6
                └── current.log</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="accessing-logs-ui_forklift">Downloading logs and custom resource information from the web console</h4>
<div class="paragraph">
<p>You can download logs and information about custom resources (CRs) for a completed, failed, or canceled migration plan or for migrated virtual machines (VMs) by using the OKD web console.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the OKD web console, click <strong>Migration</strong> &#8594; <strong>Plans for virtualization</strong>.</p>
</li>
<li>
<p>Click <strong>Get logs</strong> beside a migration plan name.</p>
</li>
<li>
<p>In the <strong>Get logs</strong> window, click <strong>Get logs</strong>.</p>
<div class="paragraph">
<p>The logs are collected. A <code>Log collection complete</code> message is displayed.</p>
</div>
</li>
<li>
<p>Click <strong>Download logs</strong> to download the archive file.</p>
</li>
<li>
<p>To download logs for a migrated VM, click a migration plan name and then click <strong>Get logs</strong> beside the VM.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="accessing-logs-cli_forklift">Accessing logs and custom resource information from the command line interface</h4>
<div class="paragraph">
<p>You can access logs and information about custom resources (CRs) from the command line interface by using the <code>must-gather</code> tool. You must attach a <code>must-gather</code> data file to all customer cases.</p>
</div>
<div class="paragraph">
<p>You can gather data for a specific namespace, a completed, failed, or canceled migration plan, or a migrated virtual machine (VM) by using the filtering options.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you specify a non-existent resource in the filtered <code>must-gather</code> command, no archive file is created.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must be logged in to the KubeVirt cluster as a user with the <code>cluster-admin</code> role.</p>
</li>
<li>
<p>You must have the <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.10/html/cli_tools/openshift-cli-oc#cli-getting-started">OKD CLI (<code>oc</code>)</a> installed.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the directory where you want to store the <code>must-gather</code> data.</p>
</li>
<li>
<p>Run the <code>oc adm must-gather</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl adm must-gather --image=quay.io/konveyor/forklift-must-gather:latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data is saved as <code>/must-gather/must-gather.tar.gz</code>. You can upload this file to a support case on the <a href="https://access.redhat.com/">Red Hat Customer Portal</a>.</p>
</div>
</li>
<li>
<p>Optional: Run the <code>oc adm must-gather</code> command with the following options to gather filtered data:</p>
<div class="ulist">
<ul>
<li>
<p>Namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl adm must-gather --image=quay.io/konveyor/forklift-must-gather:latest \
  -- NS=&lt;namespace&gt; /usr/bin/targeted</code></pre>
</div>
</div>
</li>
<li>
<p>Migration plan:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl adm must-gather --image=quay.io/konveyor/forklift-must-gather:latest \
  -- PLAN=&lt;migration_plan&gt; /usr/bin/targeted</code></pre>
</div>
</div>
</li>
<li>
<p>Virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl adm must-gather --image=quay.io/konveyor/forklift-must-gather:latest \
  -- VM=&lt;vm_name&gt; NS=&lt;namespace&gt; /usr/bin/targeted <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You must specify the VM <em>name</em>, not the VM ID, as it appears in the <code>Plan</code> CR.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>

      <footer class="site-footer">
        
          <span class="site-footer-owner"><p align="center"><a href="https://github.com/konveyor/forklift-documentation">forklift-documentation</a> is maintained by <a href="https://github.com/konveyor">konveyor</a>.</p></span>
        
      </footer>
    </main>
  </body>
</html>
